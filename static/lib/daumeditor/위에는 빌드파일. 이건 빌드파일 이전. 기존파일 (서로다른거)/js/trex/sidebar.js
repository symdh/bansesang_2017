Trex.Sidebar=Trex.Class.create({$const:{__REG_ENTRY_ATTR_PAIR_Q:new RegExp('([\\w]+)="([^"]+)"',"g"),__REG_ENTRY_ATTR_PAIR_NQ:new RegExp("([\\w]+)=([\\w]+)","g")},$mixins:[Trex.I.JobObservable],entryboxRegistry:_NULL,initialize:function(t){var e=t.getCanvas();this.entryboxRegistry={},this.getFields=function(){var t=[];for(var e in this.entryboxRegistry){var i=this.entryboxRegistry[e];t=t.concat(i.getFields())}return t},this.syncSidebar=function(){var t=e.getContent();for(var i in this.entryboxRegistry)this.entryboxRegistry[i].syncBox(t)},this.emptyEntries=function(){for(var t in this.entryboxRegistry)this.entryboxRegistry[t].empty()},e.observeJob(Trex.Ev.__CANVAS_PANEL_DELETE_SOMETHING,function(){this.syncSidebar()}.bind(this))}}),Trex.EntryBox=Trex.Class.draft({$mixins:[Trex.I.JobObservable],autoSeq:0,datalist:[],initialize:function(){throw new Error("[Exception]Trex.EntryBox : not implements function(initialize)")},newSeq:function(){return++this.autoSeq},syncSeq:function(t){return this.autoSeq=t>this.autoSeq?t:this.autoSeq,t},empty:function(){this.fireJobs(Trex.Ev.__ENTRYBOX_ALL_ENTRY_REMOVED),this.datalist=[]},append:function(t){this.datalist.push(t),this.fireJobs(Trex.Ev.__ENTRYBOX_ENTRY_ADDED,t)},modify:function(t){this.fireJobs(Trex.Ev.__ENTRYBOX_ENTRY_MODIFIED,t)},remove:function(t){t.deletedMark=_TRUE,this.fireJobs(Trex.Ev.__ENTRYBOX_ENTRY_REMOVED,t)},syncBox:function(t){this.datalist.each(function(e){e.execSync(t)})},getFields:function(){var t=[];return this.datalist.each(function(e){t.push(e.getField())}),t.findAll(function(t){return t!=_NULL})},getEntries:function(t){if(!t)return this.datalist;var e=[];return this.datalist.each(function(i){i.type==t&&e.push(i)}),e}}),Trex.Entry=Trex.Class.draft({$mixins:[Trex.I.JobObservable],existStage:_FALSE,deletedMark:_FALSE,initialize:function(){throw new Error("[Exception]Trex.Entry : not implements function(initialize)")},setExistStage:function(t){this.existStage=t},execRegister:function(){this.register(),this.entryBox.append(this),this.setExistStage(_TRUE)},execReload:function(){this.reload&&this.reload(),this.entryBox.append(this),this.exchangeHandlerAtReload()},execRemove:function(){this.remove(),this.entryBox.remove(this)},execReplace:function(t){this.replace(t),this.entryBox.modify(this),this.setExistStage(_TRUE)},execAppend:function(){this.register(),this.setExistStage(_TRUE)},execSync:function(t){this.setExistStage(this.checkExisted(t))},checkExisted:function(t){return this.canvas.isWYSIWYG()?t.search(this.regHtml)>-1:t.search(this.regText)>-1},getChangedContent:function(t,e,i,n){var r=_FALSE;return t.search(e)>-1&&(r=_TRUE,t=this.actor.canResized?this.getChangedContentWithAttr(t,e,i,n):t.replace(e,i)),this.setExistStage(r),t},getChangedContentFromHtml:function(t){return this.getChangedContent(t,this.regHtml,this.dispText,["id","class"])},getChangedContentToHtml:function(t){return this.getChangedContent(t,this.regText,this.dispHtml)},getChangedContentAtSave:function(t){return this.getChangedContent(t,this.regHtml,this.saveHtml,["id","class"])},getChangedContentAtLoad:function(t){return this.getChangedContent(t,this.regLoad,this.dispHtml)},getChangedContentWithAttr:function(t,e,i,n){n=n||[];var r,s=Trex.Util.getAllAttributes(i),a=function(t){var e=Trex.Util.getMatchValue(/<([a-z]*)/i,i,1),r=["<"+e.toLowerCase()],a=Trex.Util.getAllAttributes(t);for(var o in s)["width","height"].contains(o)?a[o]||r.push(o+'="'+s[o]+'"'):r.push(o+'="'+s[o]+'"');for(var o in a)n.contains(o)||(["width","height"].contains(o)?r.push(o+'="'+a[o]+'"'):s[o]||r.push(o+'="'+a[o]+'"'));return r.push("/>"),r.join(" ")},o=t;for(e.lastIndex=0;(r=e.exec(o))!=_NULL;){var h=r[0],c=a(h),g=h.getRegExp();t=t.replace(new RegExp(g,"gmi"),c)}return t},getField:function(){return this.field?{name:this.field.name,value:[this.field.value,this.existStage].join("|")}:_NULL},exchangeHandlerAtReload:function(){}}),Trex.Actor=Trex.Class.draft({$mixins:[Trex.I.JobObservable],isDisabled:_FALSE,initialize:function(){throw new Error("[Exception]Trex.Actor : not implements function(initialize)")},execAttach:function(t,e){var i=this.createEntry(this.getDataForEntry(t),e);i.execRegister(),this.canvas.fireJobs("canvas."+(e||this.constructor.__Identity)+".added",i)},getDatalist:function(){return this.entryBox.getEntries(this.name)},execReattach:function(t,e){var i=this.getDatalist(),n=this.getDataForEntry(t);if(i.length<1){var r=this.createEntry(n,e);r.execRegister()}else{var r=i[0],s={regHtml:r.regHtml,regText:r.regText};r.setProperties(n),r.execReplace(s)}},execReload:function(t,e,i){var n=this.getDataForEntry(t,e);if(n){var r=this.createEntry(n,i);r.execReload()}},existEntry:function(){var t=this.getDatalist().findAll(function(t){return t.deletedMark!=_TRUE});return 0!==t.length},getFirstEntryData:function(){var t=this.getDatalist().findAll(function(t){return t.deletedMark!=_TRUE});return 0==t.length?_NULL:t[0].data}});