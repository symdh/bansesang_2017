!function(){TrexConfig.addTool("background",{wysiwygonly:_TRUE,sync:_FALSE,status:_TRUE,needRevert:!0,thumbs:Trex.__CONFIG_COMMON.thumbs});var o;Trex.Tool.Background=Trex.Class.create({$const:{__Identity:"background"},$extend:Trex.Tool,oninitialized:function(){this.weave(new Trex.Button(this.buttonCfg),new Trex.Menu.ColorPallete(this.menuCfg),this.handler)},handler:function(e){var r=this,t=r.canvas;t.fireJobs("canvas.apply.backgroundcolor",e),t.history.saveHistory({backgroundColor:o,backgroundImage:t.getStyle("backgroundImage")},{backgroundColor:e,backgroundImage:t.getStyle("backgroundImage")},function(o){r._restoreColor(o)}),null===e?(t.addStyle({backgroundColor:t.getConfig().styles?t.getConfig().styles.backgroundColor||"":"",backgroundImage:t.getConfig().styles?t.getConfig().styles.backgroundImage||"":""}),o="",t.getConfig().hasUserBgcolor=_FALSE):(t.addStyle({backgroundColor:e,backgroundImage:""}),o=e,t.getConfig().hasUserBgcolor=_TRUE)},_restoreColor:function(e){var r=this.canvas;r.addStyle({backgroundColor:e.backgroundColor}),e.backgroundImage&&r.addStyle({backgroundImage:e.backgroundImage}),o=e.backgroundColor}}),Trex.install("canvas.getBgColor & canvas.setBgColor & editor.getContentWithBg",function(e,r,t,n,a){o=a.canvas.styles.backgroundColor,n.getBgColor=function(){var e=o||n.getPanel("html").getStyle("backgroundColor");return e?Trex.Color.getHexColor(e):""},n.setBgColor=function(o){n.getPanel("html").addStyle({backgroundColor:o||"transparent"})},e.getContentWithBg=function(){var o=n.getBgColor().toLowerCase();return"transparent"==o?e.getContent():['<table class="txc-wrapper" border="0" cellspacing="0" cellpadding="0"><tr>','<td bgcolor="',o,'">',e.getContent(),"</td>","</tr></table>"].join("")};var g=n.initContent.bind(n);n.initContent=function(o){if(o.search(/<table[^>]*txc-wrapper[^>]*>/i)>-1){var e;o=o.replace(/<table[^>]*txc-wrapper[^>]*><tr><td([^>]*)>([\s\S]*?)<\/td><\/tr><\/table>/i,function(o,r,t){return e=r.replace(/\sbgcolor="([#\w]*)"/,"$1"),t}),n.setBgColor(e)}g(o)},n.history.initHistory({backgroundColor:a.canvas.styles.backgroundColor,backgroundImage:a.canvas.styles.backgroundImage||"none"}),n.reserveJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){var o=n.config.articleBackgroundColor;o&&"transparent"!=o&&n.addStyle({backgroundColor:o,backgroundImage:""})}),n.observeJob("canvas.apply.letterpaper",function(o){o.id&&n.getPanel("html").addStyle({backgroundColor:"transparent"})})})}();