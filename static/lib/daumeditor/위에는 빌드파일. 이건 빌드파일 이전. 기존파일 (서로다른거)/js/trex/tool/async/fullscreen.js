!function(){var e=document,t=window,i=e.documentElement,s=!1,o=!0,r=null;Trex.Class.overwrite(Trex.Tool.FullScreen,{oninitialized:function(){var e=this.editor,t=this.config,i=e.getWrapper();if(i){var n,a=function(){n||(n=new Trex.FullScreen(e,t)),n.execute()};this.executeTool=a,t.switched&&(n||(n=new Trex.FullScreen(e,t)),n.showFullScreen()),this.resetWeave(),this.weave.bind(this)(new Trex.Button(this.buttonCfg),r,a),this.bindKeyboard({ctrlKey:o,keyCode:77},a),e.observeKey({ctrlKey:o,altKey:s,shiftKey:s,keyCode:77},a)}}}),TrexMessage.addMsg({"@fullscreen.attach.close.btn":"파일첨부박스","@fullscreen.noti.btn":"일반 글쓰기로","@fullscreen.noti.span":"넓게쓰기 버튼을 다시 누르시면 처음 글쓰기 창 크기로 돌아갑니다."}),Trex.MarkupTemplate.add("fullscreen.notice",'<div class="tx-fullscreen-notice"><span>@fullscreen.noti.span</span><a href="#">@fullscreen.noti.btn</a></div>'),Trex.MarkupTemplate.add("fullscreen.linebox",'<div class="tx-fullscreen-line"><div class="tx-fullscreen-line-division"><div class="tx-fullscreen-line-left">&nbsp;</div><div class="tx-fullscreen-line-right">&nbsp;</div></div><div class="tx-fullscreen-line-box"><div class="tx-fullscreen-line-left">&nbsp;</div><div class="tx-fullscreen-line-right">&nbsp;</div><a href="#">@fullscreen.attach.close.btn</a></div></div>'),Trex.FullScreen=Trex.Class.create({initialize:function(e,t){if(e){this.isInit=s,this.isFullScreen=s,this.editor=e,this.rootConfig=this.editor.initialConfig,this.wrapper=e.getWrapper(),this.canvas=e.getCanvas(),this.toolbar=e.getToolbar(),this.attachBox=e.getAttachBox(),this.elSavedHiddens=[],this.minHeight=t.minHeight,this.minWidth=t.minWidth,this.useAttachBox=!!this.attachBox.elBox,this.isAttachBoxDisplay=s;var i=this;this.resizeHandler=function(){i.isFullScreen&&i.resizeContainer()},this.toolbar.observeJob(Trex.Ev.__CMD_ADVANCED_FOLD,this.resizeHandler),this.toolbar.observeJob(Trex.Ev.__CMD_ADVANCED_SPREAD,this.resizeHandler),"function"==typeof showAttachBox&&(this.showAttachBoxAtServiceForSave=showAttachBox),"function"==typeof hideAttachBox&&(this.hideAttachBoxAtServiceForSave=hideAttachBox)}},execute:function(){this.isFullScreen?this.showNormalScreen():this.showFullScreen()},onAttachClick:function(){this.attachClickHandler(!this.isAttachBoxDisplay),this.resizeContainer()},attachClickHandler:function(e){e?(this.showAttachBox(),this.attachBox.fireJobs(Trex.Ev.__ATTACHBOX_FULLSCREEN_SHOW)):(this.hideAttachBox(),this.attachBox.fireJobs(Trex.Ev.__ATTACHBOX_FULLSCREEN_HIDE))},showNormalScreen:function(){if(this.isFullScreen){this._showScrollbar(),this.showNormalScreenAtService();var e=this.wrapper;if(e){if(e.style.width="",$tx.removeClassName(e,"tx-editor-fullscreen"),this.elSavedHiddens.each(function(e){e.style.visibility="visible"}),parent)try{$tx.stopObserving(parent,"resize",this.resizeHandler)}catch(e){}else $tx.stopObserving(window,"resize",this.resizeHandler);this.canvas.setCanvasSize({height:this.panelNormalHeight.toPx()}),this.useAttachBox&&this.attachClickHandler(this.attachBox.checkDisplay()),this.showAttachBoxAtServiceForSave&&(t.showAttachBox=this.showAttachBoxAtServiceForSave),this.hideAttachBoxAtServiceForSave&&(t.hideAttachBox=this.hideAttachBoxAtServiceForSave);for(var i=this.relativeParents.length,o=0;o<i;o+=1){var r=this.relativeParents.pop(),n=this.relativeValues.pop();$tx.setStyle(r,{position:n})}if(this.isFullScreen=s,!$tx.msie){var a="tx_fullscreen"+this.rootConfig.initializedId;setTimeout(function(){var e=$tom.collect($tx(a),"a");e.focus()},500)}this.canvas.fireJobs(Trex.Ev.__CANVAS_NORMAL_SCREEN_CHANGE)}}},showFullScreen:function(){var i=this;if(!this.isFullScreen){this.isInit||this.generate(),this._hideScrollbar(),this.showFullScreenAtService(),this.showAttachBoxAtServiceForSave&&(t.showAttachBox=function(){i.showAttachBox(),i.resizeContainer()}),this.hideAttachBoxAtServiceForSave&&(t.hideAttachBox=function(){i.hideAttachBox(),i.resizeContainer()});var s=this.wrapper;if(s){$tx.addClassName(s,"tx-editor-fullscreen");var r=[];["select","embed","object"].each(function(t){var i=$A(e.getElementsByTagName(t));i.each(function(e){e.style.visibility="hidden",r.push(e)})}),this.elSavedHiddens=r,this.useAttachBox&&this.attachClickHandler(this.attachBox.checkDisplay());var n=this.canvas.getCurrentPanel();this.panelNormalHeight=n.getPosition().height,window.parent?$tx.observe(window.parent,"resize",this.resizeHandler):$tx.observe(window,"resize",this.resizeHandler),t.wrapper=s,this.relativeParents=[],this.relativeValues=[];for(var a=s.offsetParent;a&&a.tagName&&"HTML"!==a.tagName&&"BODY"!==a.tagName;){var h=$tx.getStyle(a,"position");"relative"===h.toLowerCase()&&(this.relativeParents.push(a),this.relativeValues.push(h),$tx.setStyle(a,{position:"static"})),a=a.offsetParent}this.isFullScreen=o,this.resizeContainer(),this.canvas.fireJobs(Trex.Ev.__CANVAS_FULL_SCREEN_CHANGE)}}},_hideScrollbar:function(){(i.scrollTop||i.scrollLeft)&&(i.scrollTop=0,i.scrollLeft=0),(e.body.scrollTop||e.body.scrollLeft)&&(e.body.scrollTop=0,e.body.scrollLeft=0),i.style.overflow="hidden",e.body.style.overflow="hidden"},_showScrollbar:function(){$tx.msie&&$tx.msie_ver<=8?setTimeout(function(){i.style.overflow="",e.body.style.overflow=""},50):(i.style.overflow="",e.body.style.overflow="")},generate:function(){this.isInit||this.wrapper&&(this.generateNoti(),this.generateLineBox(),this.isInit=o)},generateNoti:function(){var e=this,t=Trex.MarkupTemplate.get("fullscreen.notice").evaluateAsDom({});$tom.insertFirst(this.wrapper,t);var i=$tom.collect(t,"a");$tx.observe(i,"click",function(){e.isFullScreen?e.showNormalScreen():e.showFullScreen()})},generateLineBox:function(){if(this.useAttachBox){var e=this.canvas.elContainer,t=Trex.MarkupTemplate.get("fullscreen.linebox").evaluateAsDom({});$tom.insertNext(t,e);var i={className:"tx-fullscreen-line-box"};$tx.msie_ver<="5.5"&&(i.align="center");var s=$tom.collect(t,"div.tx-fullscreen-line-box");$tx.msie_ver<="5.5"&&(s.align="center");var o=$tom.collect(s,"a");this.elLineBtn=o,$tx.observe(o,"click",this.onAttachClick.bind(this))}},getAttachBoxPosition:function(){return this.isAttachBoxDisplay?$tom.getPosition(this.attachBox.elBox):{x:0,y:0,width:0,height:0}},getPostAreaBoxPosition:function(){var e=$tx("tx_fullscreen_post_area");return e?$tx.getDimensions(e):{x:0,y:0,width:0,height:0}},resizeContainer:function(){if(!this.isFullScreen)return s;this.resizeScreenAtService();var e,t;return e=this.getPanelHeight(),this.canvas.setCanvasSize({height:e.toPx()}),this.wrapper&&(t=this.getPanelWidth(),this.wrapper.style.width=t.toPx()),o},getPanelHeight:function(){var e=0,t=this.canvas.getCanvasPos().y,s=this.useAttachBox?17:0;e=i.clientHeight>0?i.clientHeight-t-s:i.offsetHeight-t-s;var o=this.getPostAreaBoxPosition();e-=o.height;var r=this.getAttachBoxPosition();return r.height>0&&(e-=r.height+20),Math.max(e,this.minHeight)},getPanelWidth:function(){var e=0;return e=i.clientWidth>0?i.clientWidth:i.offsetWidth,Math.max(e,this.minWidth)},showAttachBox:function(){this.attachBox.useBox&&($tx.addClassName(this.elLineBtn,"tx-attach-close"),$tx.show(this.attachBox.elBox),this.isAttachBoxDisplay=o)},hideAttachBox:function(){this.attachBox.useBox&&($tx.removeClassName(this.elLineBtn,"tx-attach-close"),$tx.hide(this.attachBox.elBox),this.isAttachBoxDisplay=s)},showFullScreenAtService:function(){"function"==typeof showFullScreen&&showFullScreen()},showNormalScreenAtService:function(){"function"==typeof showNormalScreen&&showNormalScreen()},resizeScreenAtService:function(){"function"==typeof resizeScreen&&resizeScreen()}});var n="fullscreen";Editor.forEachEditor(function(e){e.getTool()[n].oninitialized()}),Editor.editorForAsyncLoad.getTool()[n].executeTool()}();