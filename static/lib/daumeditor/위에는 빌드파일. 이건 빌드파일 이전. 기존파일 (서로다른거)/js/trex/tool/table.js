TrexConfig.addTool("table",{borderStyle:"1px solid #ccc",sync:_FALSE,status:_TRUE},function(t){var e=TrexConfig.get("canvas",t).styles.backgroundColor;"transparent"!=e&&(TrexConfig.getTool("table",t).bgcolor=e)}),TrexMessage.addMsg({"@table.alert":"1 이상 99 이하의 숫자만 입력 가능합니다."}),Trex.Tool.Table=Trex.Class.create({$const:{__Identity:"table",__DEFAULT_TABLE_PROPERTY:{cellSpacing:0,cellPadding:1,border:0,style:{border:"none",borderCollapse:"collapse"}},__DEFAULT_TABLE_PROPERTY_STR:'cellspacing="0" cellpadding="0" border="0"',__DEFAULT_TABLE_STYLE:"border:none;border-collapse:collapse;",__DEFAULT_TABLE_CLASS:"txc-table",__DEFAULT_TABLE_CELL_HEIGHT:24},$extend:Trex.Tool,oninitialized:function(t){var e=this;this.tableSize={row:0,col:0};var i=this.canvas,r=this.handler=function(t){i.execute(function(i){var r="100%";i.executeUsingCaret(function(t,i){var l=i.getCaret(_FALSE);$tom.ancestor(l,"table")||(r=e.getDefaultTableWidth())});var l=e.makeEmptyTable(t.row,t.col,r),n=i.pasteContent(l,_TRUE);i.bookmarkInto(n),e.toolbar.tools.advanced&&e.toolbar.tools.advanced.forceOpen()})};this.weave.bind(this)(new Trex.Button(this.buttonCfg),new Trex.Menu.Table(this.menuCfg),r)},makeEmptyTable:function(t,e,i){var r=[];r.push('<table class="'+Trex.Tool.Table.__DEFAULT_TABLE_CLASS+'"'),i&&r.push(' width="'+i+'"'),r.push(Trex.Tool.Table.__DEFAULT_TABLE_PROPERTY_STR),r.push(' style="'),r.push(Trex.Tool.Table.__DEFAULT_TABLE_STYLE),r.push(";font-family:"),r.push(this.editor.canvas.getStyle("fontFamily")),r.push(";font-size:"),r.push(this.editor.canvas.getStyle("fontSize")),r.push('"><tbody>');for(var l=this.config.borderStyle,n=this.getDefaultCellWidth(e,i),a=this.getDefaultCellHeight(t),o=["border-bottom:",l,";border-right:",l,";"].join(""),s=0;s<t;s++){r.push("<tr>");for(var c=0;c<e;c++){r.push('<td style="width:'),r.push(n),r.push(";"),r.push("height:",a,";"),r.push(o),0==s&&r.push("border-top:",l,";"),0==c&&r.push("border-left:",l,";"),r.push(';"><p>'+$tom.EMPTY_BOGUS+"</p></td>")}r.push("</tr>")}return r.push("</tbody></table>"),r.join("")},getDefaultCellWidth:function(t,e){var i;return e=e||"100%",e.toString().indexOf("%")!==-1?i=100/t+"%":(i=parseInt(parseInt(e,10)/t,10),isNaN(i)&&(i=0),i=i.toPx()),i},getDefaultCellHeight:function(t){return Trex.Tool.Table.__DEFAULT_TABLE_CELL_HEIGHT.toPx()},getDefaultTableWidth:function(){var t=this.config.tableWidth;return t||(t=this.getCanvasInnerWidth()),t},getCanvasInnerWidth:function(){var t=this.canvas.getSizeConfig().contentPadding||8;return(this.canvas.getSizeConfig().contentWidth||600)-2*t-20}}),Trex.Tool.Table.TemplateWizard=Trex.Class.create({initialize:function(){this.templateList="function"==typeof getTableTemplateList?getTableTemplateList():[{klass:"ex1",common:{backgroundColor:"transparent",borderTop:"none",borderLeft:"none",borderRight:"1px solid #d9d9d9",borderBottom:"1px solid #d9d9d9"},firstRow:{borderTop:"1px solid #000"},firstCol:{borderLeft:"1px solid #000"},lastCol:{borderRight:"1px solid #000"},lastRow:{borderBottom:"1px solid #000"},evenRow:{},oddRow:{}}],this.currentTemplate=_NULL},applyStyle:function(t,e){if(!isNaN(e)){var i=new Trex.Tool.Table.TableCellMatrixer(t),r=i.getTdMatrix();this.currentTemplate=this.templateList[e];for(var l=0;l<r.length;l++)for(var n=0;n<r[l].length;n++)this.setCellStyle(r[l][n],{isEvenRow:l%2==1,isFirstRow:0==l,isLastRow:l==r.length-1,isFirstCol:0==n,isLastCol:n==r[l].length-1})}},setCellStyle:function(t,e){var i=this.currentTemplate,r=Object.extend({},i.common);Object.extend(r,e.isEvenRow?i.evenRow:i.oddRow),Object.extend(r,e.isFirstRow?i.firstRow:e.isLastRow?i.lastRow:{}),Object.extend(r,e.isLastCol?i.lastCol:{}),Object.extend(r,e.isFirstCol?i.firstCol:{}),txlib.setStyle(t,r)},getTemplateList:function(){return this.templateList}}),Trex.Tool.Table.TableCellMatrixer=Trex.Class.create({initialize:function(t){this.rowSize=this.initRowSize(t),this.colSize=this.initColSize(t);var e=$tom.first(t,"tbody")||t;this.tdMatrix=this.createTdMatrix(e);for(var i=0;i<this.tdMatrix.length;i++)for(var r=0;r<this.tdMatrix[i].length;r++){var l=this.tdMatrix[i][r];l.cols>1&&(l.cols--,this.tdMatrix[i].splice(r+1,0,l))}for(var i=0;i<this.tdMatrix.length;i++)for(var r=0;r<this.tdMatrix[i].length;r++){var l=this.tdMatrix[i][r];l.rows>1&&(l.rows--,this.tdMatrix[i+1].splice(r,0,l))}},createTdMatrix:function(t){for(var e=[],i=$tom.children(t,"tr"),r=0,l=i.length;r<l;r++)e.push(this.createTdArray(i[r]));return e},createTdArray:function(t){for(var e=[],i=$tom.children(t,"td"),r=0,l=i.length;r<l;r++)e.push(this.decorateSingleTd(i[r]));return e},decorateSingleTd:function(t){var e=parseInt(t.getAttribute("colSpan")||1),i=parseInt(t.getAttribute("rowSpan")||1);return t.cols=e,t.rows=(i-1)*e+1,t},initRowSize:function(t){return t.rows.length},initColSize:function(t){var e=0,i=$tom.children($tom.collect(t,"tr"),"td");return i.each(function(t){e+=parseInt(t.getAttribute("colSpan")||1)}),e},getRowSize:function(){return this.rowSize},getColSize:function(){return this.colSize},getTdMatrix:function(){return this.tdMatrix}}),TrexMessage.addMsg({"@table.title.insert":"표삽입 &nbsp;","@table.title.setDirectly":"표 직접설정","@table.title.row":"열 개수","@table.title.col":"행 개수"}),Trex.MarkupTemplate.add("menu.table.direct",["<div>@table.title.setDirectly</div>",'<div class="tx-table-input-area">','<div class="tx-field tx-col-field">@table.title.row<input type="text" value="1"><a class="tx-btn tx-btn-add" href="javascript:;">@table.title.row+</a><a class="tx-btn tx-btn-sub" href="javascript:;">@table.title.row-</a></div>','<div class="tx-field tx-row-field">@table.title.col<input type="text" value="1"><a class="tx-btn tx-btn-add" href="javascript:;">@table.title.col+</a><a class="tx-btn tx-btn-sub" href="javascript:;">@table.title.col-</a></div>',"</div>"].join("")),Trex.Menu.Table=Trex.Class.create({$const:{MAX_ROW:99,MAX_COL:99},$extend:Trex.Menu,ongenerated:function(){this.rowSize=1,this.colSize=1,this.elInnerPreview=$tom.collect(this.elMenu,"div.tx-menu-inner .tx-menu-preview"),this.dynamicSizer=this.generateDynamicSizer(this.elInnerPreview),this.elInnerRowCol=$tom.collect(this.elMenu,"div.tx-menu-inner .tx-menu-rowcol"),this.generateTextSizer(this.elInnerRowCol),this.elButtonArea=$tom.collect(this.elMenu,"div.tx-menu-inner .tx-menu-enter"),this.generateButtonArea(this.elButtonArea)},onregenerated:function(){this.showDynamicSizer()},showDynamicSizer:function(){this.dynamicSizer.clear(),$tx.show(this.elInnerPreview),$tx.hide(this.elInnerRowCol),$tx.hide(this.elButtonArea)},showTextSizer:function(){$tx.hide(this.elInnerPreview),$tx.show(this.elInnerRowCol),$tx.show(this.elButtonArea)},generateDynamicSizer:function(t){var e=this,i=tx.span(),r=tx.div({className:"tx-dynamic-sizer-display"},TXMSG("@table.title.insert"),i);t.appendChild(r);var l=new Trex.DynamicSizer({el:t,clickHandler:this.onSelect.bind(this),moveHandler:function(t,e){i.innerHTML=t+"x"+e}}),n=tx.a({href:"javascript:;"},TXMSG("@table.title.setDirectly"));$tx.observe(n,"click",function(t){e.showTextSizer(),$tx.stop(t),e.fireJobs(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,{detail:{menu:e}})});var a=tx.div({className:"tx-more-button"});return a.appendChild(n),t.appendChild(a),l},generateTextSizer:function(t){var e=this;Trex.MarkupTemplate.get("menu.table.direct").evaluateToDom({},t);var i={calculate:function(t,e,i){return t=parseInt(t),t+i>e||t+i<1?(alert(TXMSG("@table.alert")),t):t+i},getValidValue:function(t,e,i){return t<=0||t>i?(alert(TXMSG("@table.alert")),e):t}},r=$tom.collect(t,"div.tx-col-field input");$tx.observe(r,"blur",function(){r.value=e.colSize=i.getValidValue(r.value,e.colSize,Trex.Menu.Table.MAX_COL)}),$tx.observe($tom.collect(t,"div.tx-col-field a.tx-btn-add"),"click",function(t){return r.value=e.colSize=i.calculate(e.colSize,Trex.Menu.Table.MAX_COL,1),$tx.stop(t),_FALSE}),$tx.observe($tom.collect(t,"div.tx-col-field a.tx-btn-sub"),"click",function(t){return r.value=e.colSize=i.calculate(e.colSize,Trex.Menu.Table.MAX_COL,-1),$tx.stop(t),_FALSE});var l=$tom.collect(t,"div.tx-row-field input");$tx.observe(l,"blur",function(){l.value=e.rowSize=i.getValidValue(l.value,e.rowSize,Trex.Menu.Table.MAX_ROW)}),$tx.observe($tom.collect(t,"div.tx-row-field a.tx-btn-add"),"click",function(t){return l.value=e.rowSize=i.calculate(e.rowSize,Trex.Menu.Table.MAX_ROW,1),$tx.stop(t),_FALSE}),$tx.observe($tom.collect(t,"div.tx-row-field a.tx-btn-sub"),"click",function(t){return l.value=e.rowSize=i.calculate(e.rowSize,Trex.Menu.Table.MAX_ROW,-1),$tx.stop(t),_FALSE})},generateButtonArea:function(t){var e=this,i=tx.div(),r=tx.a({href:"javascript:;",className:"tx-btn-confirm"},"확인"),l=tx.a({href:"javascript:;",className:"tx-btn-cancel"},"취소");$tx.observe(r,"click",function(t){e.onSelect(t,{row:e.rowSize,col:e.colSize})}),$tx.observe(l,"click",function(t){return $tx.stop(t),this.onCancel(),_FALSE}.bindAsEventListener(this)),i.appendChild(r),i.appendChild(l),t.appendChild(i)}});