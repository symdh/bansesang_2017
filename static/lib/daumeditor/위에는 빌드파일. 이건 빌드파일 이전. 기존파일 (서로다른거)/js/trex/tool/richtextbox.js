TrexConfig.addTool("richtextbox",{sync:_FALSE,status:_TRUE,rows:4,cols:6,borderwidth:1,bordercolor:"#cbcbcb",bgcolor:"#ffffff",padding:"10px",styles:[{klass:"",image:"#iconpath/textbox/thum_line01.gif?v=2",data:"solid"},{klass:"",image:"#iconpath/textbox/thum_line02.gif?v=2",data:"double"},{klass:"",image:"#iconpath/textbox/thum_line03.gif?v=2",data:"dashed"},{klass:"",image:"#iconpath/textbox/thum_line04.gif?v=2",data:"none"}],options:Trex.__CONFIG_COMMON.textbox.options,thumbs:Trex.__CONFIG_COMMON.thumbs}),TrexMessage.addMsg({"@richtextbox.add":"더하기","@richtextbox.sub":"빼기","@richtextbox.alert":"1 이상 20 이하의 숫자만 입력 가능합니다.","@richtextbox.bg.color":"배경색","@richtextbox.border.color":"선 색","@richtextbox.border.style":"선 스타일","@richtextbox.border.width":"선 굵기"}),Trex.Tool.RichTextBox=Trex.Class.create({$const:{__Identity:"richtextbox"},$extend:Trex.Tool,oninitialized:function(){var e=this.canvas,t=this.toolbar,o=this,r=this.handler=function(){var r=o.menu,l={borderStyle:r.elPreview.style.borderStyle,borderWidth:r.elPreview.style.borderWidth,borderColor:r.elPreview.style.borderColor,backgroundColor:r.elPreview.style.backgroundColor,padding:r.padding},i="div",a={className:"txc-textbox",style:l};e.execute(function(e){var o,r=e.blocks(function(){return"%wrapper,%paragraph"});r=r.findAll(function(r){return $tom.kindOf(r,"%innergroup")?(o=e.wrap($tom.children(r),i,a),t.fireJobs("cmd.textbox.added",o),_FALSE):_TRUE}),o=e.wrap(r,i,a),t.fireJobs("cmd.textbox.added",o)})};this.weave.bind(this)(new Trex.Button(this.buttonCfg),new Trex.Menu.RichTextbox(this.menuCfg),r)}}),Trex.MarkupTemplate.add("richtextbox.colorpallete",['<dd class="#{wrapClass}">','\t<div class="tx-color-box">','\t\t<a href="javascript:;" class="tx-color-bg-thumb" style="background-color:#{color}"></a>',"\t</div>",'\t<a href="javascript:;" class="tx-color-arrow-down"></a>','\t<div class="tx-colorpallete" unselectable="on" style="display:none;z-index:15000;"></div>',"</dd>"].join("")),Trex.Menu.RichTextbox=Trex.Class.create({$extend:Trex.Menu,ongenerated:function(e){var t=this,o={};e.options.each(function(e){o[e.data]=e.style}),this.borderWidth=e.borderWidth||1,this.borderColor=e.borderColor||"#cbcbcb",this.bgColor=e.bgColor||"#ffffff",this.padding=e.padding;var r=this.generateBorderStyle.bind(this),l=this.generateBorderWidth.bind(this),i=this.generateBorderColor.bind(this),a=this.generateBgColor.bind(this),n=this.elMenu,d=$tom.collect(n,"div.tx-menu-header"),c=$tom.collect(d,"div.tx-menu-preview-area");this.elPreview=$tom.collect(c,"div.tx-menu-preview");var s=this.elSwitch=$tom.collect(d,"div.tx-menu-switch"),x=$tom.collect(s,"div.tx-menu-simple"),b=$tom.collect(s,"div.tx-menu-advanced"),h=$tom.collect(n,"div.tx-menu-inner"),u=$tom.collect(n,"div.tx-menu-footer"),v=$tom.collect(u,"img.tx-menu-confirm"),p=$tom.collect(u,"img.tx-menu-cancel");!function(){var r=t.simplePalette=tx.div({className:"tx-menu-list"});h.appendChild(r);var l=e.rows,i=e.cols;r.innerHTML=Trex.HtmlCreator.createTableMarkup(l,i,e.options),$tx.observe(r,"click",function(e){var t=$tx.element(e);TrexEvent.fire(t,{span:function(){var e;e=t.firstChild&&1==t.firstChild.nodeType&&"img"==t.firstChild.tagName.toLowerCase()?t.firstChild.title:t.innerText;var r=o[e];f(r)}}),$tx.stop(e)})}(),function(){var e=t.advancedPalette=tx.div({className:"tx-advanced-list"});h.appendChild(e),e.appendChild(tx.dl({style:{height:"24px"}},tx.dt(TXMSG("@richtextbox.border.style")),r())),e.appendChild(tx.dl(tx.dt(TXMSG("@richtextbox.border.width")),l())),e.appendChild(tx.dl(tx.dt(TXMSG("@richtextbox.border.color")),i())),e.appendChild(tx.dl(tx.dt(TXMSG("@richtextbox.bg.color")),a()))}();var m=function(){t.borderWidthInput.value=parseInt(t.elPreview.style.borderWidth),t.borderColorInput.style.backgroundColor=t.elPreview.style.borderTopColor,t.bgColorInput.style.backgroundColor=t.elPreview.style.backgroundColor},f=function(e){t.elPreview.style.border=e.border,t.elPreview.style.backgroundColor=e.backgroundColor},g=function(e){"simple"==e?($tx.addClassName(x,"tx-selected"),$tx.show(t.simplePalette),$tx.removeClassName(b,"tx-selected"),$tx.hide(t.advancedPalette)):"advanced"==e&&($tx.removeClassName(x,"tx-selected"),$tx.hide(t.simplePalette),$tx.addClassName(b,"tx-selected"),$tx.show(t.advancedPalette),m()),t.fireJobs(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,{detail:{menu:t}})};!function(){$tx.observe(x,"click",g.bind(t,"simple")),$tx.observe(b,"click",g.bind(t,"advanced")),$tx.observe(v,"click",t.onSelect.bind(t)),$tx.observe(p,"click",function(){t.onCancel()})}(),g("simple"),f(o["txc-textbox13"])},generateBorderStyle:function(){var e=this,t=tx.dd({className:"tx-border-area"});return $tx.observe(t,"click",function(t){var o=$tx.element(t);TrexEvent.fire(o,{img:function(t){var o=t.getAttribute("data");e.elPreview.style.borderStyle=o,"double"==o&&e.borderWidthInput.value.toNumber()<3&&(e.elPreview.style.borderWidth="3px",e.borderWidthInput.value="3")}}),$tx.stop(t)}),t.innerHTML=Trex.HtmlCreator.createTableMarkup(1,4,this.config.styles),t},generateBorderWidth:function(){var e=this,t=tx.dd({className:"tx-border-area"}),o=this.borderWidthInput=tx.input({type:"text",value:this.borderWidth});t.appendChild(o);var r=function(t){t>20?(alert(TXMSG("@richtextbox.alert")),o.value=20):t<1?(alert(TXMSG("@richtextbox.alert")),o.value=1):(e.elPreview.style.borderWidth=t+"px",o.value=t)};$tx.observe(o,"blur",function(e){r(o.value.toNumber(),e)}),$tx.observe(o,"keydown",function(e){e.keyCode==$tx.KEY_RETURN&&$tx.stop(e)});var l=tx.a({href:"javascript:;",className:"btn_add"},TXMSG("@richtextbox.add"));t.appendChild(l),$tx.observe(l,"click",function(e){r(o.value.toNumber()+1),$tx.stop(e)});var i=tx.a({href:"javascript:;",className:"btn_sub"},TXMSG("@richtextbox.sub"));return t.appendChild(i),$tx.observe(i,"click",function(e){r(o.value.toNumber()-1),$tx.stop(e)}),t},generateBorderColor:function(){var e=this,t=Trex.MarkupTemplate.get("richtextbox.colorpallete").evaluateAsDom({color:this.borderColor,wrapClass:"tx-color-wrap"}),o=$tom.collect(t,"div.tx-colorpallete"),r=function(t){e.elPreview.style.borderColor=a.style.backgroundColor=e.borderColor=t},l=_NULL,i=function(){l==_NULL?(l=e.createColorPallete(o,r),l.show()):$tx.visible(o)?l.hide():l.show()};this.externalBorderColorToggler=function(){$tx.visible(o)&&l.hide()};var a=this.borderColorInput=$tom.collect(t,".tx-color-box a");$tx.observe(a,"click",function(t){e.externalBgColorToggler(),i(),$tx.stop(t)});var n=$tom.collect(t,"a.tx-color-arrow-down");return $tx.observe(n,"click",function(t){e.externalBgColorToggler(),i(),$tx.stop(t)}),t},createColorPallete:function(e,t){var o=this,r=new Trex.Menu.ColorPallete({el:e,thumbs:this.config.thumbs});return r.setCommand(t),r.observeJob(Trex.Ev.__MENU_LAYER_SHOW,function(e){o.fireJobs(Trex.Ev.__MENU_LAYER_SHOW,e)}),r.observeJob(Trex.Ev.__MENU_LAYER_HIDE,function(e){o.fireJobs(Trex.Ev.__MENU_LAYER_HIDE,e)}),r.observeJob(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,function(e){o.fireJobs(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,e)}),r},generateBgColor:function(){var e=this,t=Trex.MarkupTemplate.get("richtextbox.colorpallete").evaluateAsDom({color:this.bgColor}),o=$tom.collect(t,"div.tx-colorpallete"),r=function(t){e.elPreview.style.backgroundColor=a.style.backgroundColor=e.bgColor=t},l=_NULL,i=function(){l==_NULL?(l=e.createColorPallete(o,r),l.show()):$tx.visible(o)?l.hide():l.show()};this.externalBgColorToggler=function(){$tx.visible(o)&&l.hide()};var a=this.bgColorInput=$tom.collect(t,".tx-color-box a");$tx.observe(a,"click",function(t){e.externalBorderColorToggler(),i(),$tx.stop(t)});var n=$tom.collect(t,"a.tx-color-arrow-down");return $tx.observe(n,"click",function(t){e.externalBorderColorToggler(),i(),$tx.stop(t)}),t}});