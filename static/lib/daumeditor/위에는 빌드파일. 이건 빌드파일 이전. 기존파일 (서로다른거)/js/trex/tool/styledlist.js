TrexMessage.addMsg({"@styledlist.subtitle1":"취소","@styledlist.subtitle2":"동그라미","@styledlist.subtitle3":"네모","@styledlist.subtitle4":"숫자","@styledlist.subtitle5":"로마숫자","@styledlist.subtitle6":"알파벳"}),TrexConfig.addTool("styledlist",{status:_TRUE,options:[{label:TXMSG("@styledlist.subtitle1"),title:"cancel",type:"cancel",data:"cancel",klass:"tx-styledlist-0"},{label:TXMSG("@styledlist.subtitle2"),title:"disc",type:"ul",data:"disc",klass:"tx-styledlist-1"},{label:TXMSG("@styledlist.subtitle3"),title:"square",type:"ul",data:"square",klass:"tx-styledlist-2"},{label:TXMSG("@styledlist.subtitle4"),title:"decimal",type:"ol",data:"decimal",klass:"tx-styledlist-3"},{label:TXMSG("@styledlist.subtitle5"),title:"upper-roman",type:"ol",data:"upper-roman",klass:"tx-styledlist-4"},{label:TXMSG("@styledlist.subtitle6"),title:"upper-alpha",type:"ol",data:"upper-alpha",klass:"tx-styledlist-5"}],hotKey:{ul:{ctrlKey:_TRUE,altKey:_TRUE,keyCode:85},ol:{ctrlKey:_TRUE,altKey:_TRUE,keyCode:79}}}),Trex.Tool.StyledList=Trex.Class.create({$const:{__Identity:"styledlist"},$extend:Trex.Tool,oninitialized:function(t){var e=this;e.createListStyleMap(t),e.weave(new Trex.Button.StyledList(e.buttonCfg),new Trex.Menu.Select(e.menuCfg),e.handler,e.menuInitHandler.bind(e)),e.indentHelper=Trex.Tool.Indent.Helper,e.bindKeyboard(t.hotKey.ul,e.handler.bind(e,"disc")),e.bindKeyboard(t.hotKey.ol,e.handler.bind(e,"decimal")),e.startSyncButtonWithStyle()},createListStyleMap:function(t){var e=this.listStyleMap={};t.options.each(function(t){e[t.data]={type:t.type,klass:t.klass}})},handler:function(t){var e=this;if(e.listStyleMap[t]){var i=e.listStyleMap[t].type,s={listStyleType:t};e.canvas.execute(function(t){"cancel"==i?e.outdentListItem(t):e.createListFromSelection(t,i,s)})}},outdentListItem:function(t){t.executeUsingCaret(function(e,i){var s=Trex.Tool.Indent.Helper.findBlocksToIndentFromRange(e,t,i);s.each(function(e){Trex.Tool.Indent.Operation.OutdentListItem(e,t)})})},createListFromSelection:function(t,e,i){var s=this;t.executeUsingCaret(function(n,l){var a=s.indentHelper.findBlocksToIndentFromRange(n,t,l),r=s.groupEachList(a);r.each(function(s){var n=new Trex.Tool.StyledList.ListBuilder(t,e,i);n.createListForNodes(s)})}),this._removeBrInListItemForIE(t)},_removeBrInListItemForIE:function(t){if($tx.msie_docmode>=11){var e=t.createGoogRange(),i=e.getStartNode();e.isCollapsed()&&$tom.isElement(i)&&$tom.isElement(i.firstChild)&&$tom.isTagName(i.firstChild,"br")&&($tom.remove(i.firstChild),i.appendChild(t.newText("")))}},groupEachList:function(t){var e=this.indentHelper,i=[],s=[],n=_NULL;return t.each(function(t){var l=e.findCurrentCell(t);l!=n&&(s.length>0&&(i.push(s),s=[]),n=l),s.push(t)}),s.length>0&&i.push(s),i},menuInitHandler:function(){var t=this.canvas.query(function(t){return!!t.findNode("%listhead")}),e=$tom.collect(this.menu.elMenu,"li");t?$tx.show(e):$tx.hide(e)},startSyncButtonWithStyle:function(){var t=this,e=t.canvas,i=t.getDefaultProperty();e.observeJob(Trex.Ev.__CANVAS_PANEL_QUERY_STATUS,function(){var s=e.query(function(t){var e=t.findNode("%listhead");return t.queryStyle(e,"listStyleType")});if(s=s||t.getDefaultProperty(),i!=s){var n=t.getButtonClassByValue(s);t.button.setText(n),i=s}})},getDefaultProperty:function(){return"decimal"},getButtonClassByValue:function(t){var e=this.listStyleMap;return e[t]?e[t].klass:e[this.getDefaultProperty()].klass}}),Trex.Button.StyledList=Trex.Class.create({$extend:Trex.Button.Select,setText:function(t){this.elIcon.className="tx-icon "+t}}),Trex.Tool.StyledList.ListBuilder=Trex.Class.create({currentDepth:_NULL,prepared:_FALSE,listElement:_NULL,uselessListCandidate:[],processor:_NULL,initialize:function(t,e,i){this.processor=t,this.listTag=e,this.listStyle=i},createListForNodes:function(t){var e=this,i=e.getNodeDepthList(t);i.each(function(t){var i=t.node,s=t.depth;e.prepared||e.prepareRootList(i,s),e.adjustDepth(i,s),e.appendAsListItem(i)}),e.cleanupEmptyList()},getNodeDepthList:function(t){var e=this;return t.map(function(t){return{node:t,depth:e.countDepthOfList(t)}})},countDepthOfList:function(t){for(var e=0,i=$tom.parent(t);i&&!$tom.isBody(i);){if($tom.kindOf(i,"ol,ul"))e++;else if($tom.kindOf(i,"th,td"))break;i=$tom.parent(i)}return e||1},prepareRootList:function(t,e){var i=this;i.listElement=i.createNewList();var s;"LI"==t.tagName?(i.uselessListCandidate.push(t.parentNode),s=$tom.divideNode(t.parentNode,$tom.indexOf(t))):s=t,$tom.insertAt(i.listElement,s),i.currentDepth=e,i.listDepth=e,i.prepared=_TRUE},adjustDepth:function(t,e){for(var i=this;e!=i.currentDepth;)e>i.currentDepth?i.increaseDepth():i.decreaseDepth()},increaseDepth:function(){var t=this,e=t.listElement;t.currentDepth++;var i=t.createNewList();e.appendChild(i),t.listElement=i},decreaseDepth:function(){var t=this,e=t.listElement;if(t.currentDepth--,t.listDepth>t.currentDepth){t.uselessListCandidate.push(e.parentNode);var i=$tom.divideNode(e.parentNode,$tom.indexOf(e)),s=t.createNewList();$tom.insertAt(s,i),s.appendChild(e)}t.listElement=e.parentNode},createNewList:function(){var t=this,e=t.processor.newNode(t.listTag);return $tx.setStyle(e,t.listStyle),e},cleanupEmptyList:function(){this.uselessListCandidate.each(function(t){$tom.removeListIfEmpty(t)})},wrapWithListItem:function(t){if("LI"==t.tagName)return t;if("P"==t.tagName||$tx.webkit&&"DIV"==t.tagName){var e=this.createListItem();return $tom.applyStyles(t,{marginLeft:_NULL}),$tom.getStyleText(t)?($tom.wrap(e,t),e):$tom.replace(t,e)}var i=this.createListItem();return i.appendChild(t),i},createListItem:function(){return this.processor.newNode("li")},appendAsListItem:function(t){var e=this.wrapWithListItem(t);$tom.kindOf(t.parentNode,"%listhead")&&this.uselessListCandidate.push(t.parentNode),this.listElement.appendChild(e)}});