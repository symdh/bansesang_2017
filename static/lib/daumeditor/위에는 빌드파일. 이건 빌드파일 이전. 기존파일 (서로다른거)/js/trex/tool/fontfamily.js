TrexMessage.addMsg({"@fontfamily.gulim":"굴림","@fontfamily.batang":"바탕","@fontfamily.dotum":"돋움","@fontfamily.gungsuh":"궁서"}),TrexConfig.addTool("fontfamily",{sync:_TRUE,status:_TRUE,useFavorite:_TRUE,options:[{label:TXMSG("@fontfamily.gulim")+' (<span class="tx-txt">가나다라</span>)',title:TXMSG("@fontfamily.gulim"),data:"Gulim,굴림,AppleGothic,sans-serif",klass:"tx-gulim"},{label:TXMSG("@fontfamily.batang")+' (<span class="tx-txt">가나다라</span>)',title:TXMSG("@fontfamily.batang"),data:"Batang,바탕,serif",klass:"tx-batang"},{label:TXMSG("@fontfamily.dotum")+' (<span class="tx-txt">가나다라</span>)',title:TXMSG("@fontfamily.dotum"),data:"Dotum,돋움,sans-serif",klass:"tx-dotum"},{label:TXMSG("@fontfamily.gungsuh")+' (<span class="tx-txt">가나다라</span>)',title:TXMSG("@fontfamily.gungsuh"),data:"Gungsuh,궁서,serif",klass:"tx-gungseo"},{label:'Arial (<span class="tx-txt">abcde</span>)',title:"Arial",data:"Arial,sans-serif",klass:"tx-arial"},{label:'Verdana (<span class="tx-txt">abcde</span>)',title:"Verdana",data:"Verdana,sans-serif",klass:"tx-verdana"},{label:'Courier New (<span class="tx-txt">abcde</span>)',title:"Courier New",data:"Courier New,monspace",klass:"tx-courier-new"}]}),Trex.Tool.FontFamily=Trex.Class.create({$const:{__Identity:"fontfamily"},$extend:Trex.Tool,$mixins:[Trex.I.CookieBaker,Trex.I.FontTool,Trex.I.MenuFontTool,Trex.I.WrappingSpanFontTool],beforeOnInitialized:function(t){function e(t){n.usedWebFonts=$tx.msie&&t.webfont&&t.webfont.use?t.webfont.options:[],n.usedFonts=t.options.concat(n.usedWebFonts)}function a(t){t.useFavorite&&n.usedWebFonts.length>0?(n.useFavorite=_TRUE,n.initCookie("txFontFamilyFavorite")):n.useFavorite=_FALSE}var n=this;n.focusLoosed=_FALSE,e(t),a(t),n.createFontFamilyMap(n.usedFonts)},createFontFamilyMap:function(t){var e=this,a={};this.fontFamilyMap=a,t.each(function(t){var n,s,o,i;for(n=t.data.split(","),s=t.title,o=0;o<n.length;o+=1)i=e.preprocessFontFamily(n[o]),a[i]=s;a[s.toLowerCase()]||(a[s.toLowerCase()]=s)})},createButton:function(){var t=new Trex.Button.Select(this.buttonCfg);return this.button=t,t.setValue(this.getDefaultProperty()),t.setText(this.getTextByValue(this.getDefaultProperty())),t},createMenu:function(){var t=this,e=new Trex.Menu.Select(TrexConfig.merge(t.menuCfg,{options:t.usedFonts}));if(this.menu=e,e.generateListItem=function(t){var e,a,n,s=[];for(e=0;e<t.length;e+=1)a=t[e],n=a.label,a.label=a.label.replace(/<span class="tx\-txt">/,'<span class="tx-txt" style="font-family:'+a.data+';">'),s.push(Trex.MarkupTemplate.get("menu.select.item").evaluate(a)),a.label=n;return s.join("")},t.usedWebFonts.length>0){$tx.addClassName(e.elMenu,"tx-fontfamily-webfont-menu");var a=tx.input({type:"text",className:"tx-dummyfocus"});$tom.append(e.elMenu,a),$tx.observe(e.elMenu,"mousedown",function(e){e.offsetX<t.menu.elMenu.clientWidth||(a.style.top=e.offsetY.toPx(),t.focusLoosed||(a.focus(),a.blur(),t.menu.elMenu.focus(),t.focusLoosed=_TRUE))})}return e},menuInitHandler:function(){var t=this,e=t.menu;if(t.focusLoosed=_FALSE,!t.useFavorite)return[];e.elMenu.scrollTop=0;var a=$tom.collect(e.elMenu,"ul.tx-menu-favlist");a&&$tom.remove(a);var n=t.extractOptions(t.usedFonts,t.readCookie());return a=e.generateList(n),$tom.insertFirst(e.elMenu,a),$tx.addClassName(a,"tx-menu-favlist"),n},onBeforeHandler:function(t){this.canvas.includeWebfontCss("font-family: "+t)},onAfterHandler:function(t){var e=this;e.useFavorite&&e.writeCookie(e.mergeValues(e.readCookie(),t))},getDefaultProperty:function(){return this.canvas.getStyleConfig().fontFamily},getRelatedCssPropertyNames:function(){return["font",this.getCssPropertyName()]},getCssPropertyName:function(){return"fontFamily"},getQueryCommandName:function(){return"fontname"},getFontTagAttribute:function(){return"face"},preprocessFontFamily:function(t){return t.toLowerCase().replace(/'|"/g,"").replace(/_?9$/,"")},getTextByValue:function(t){return t.include(",")&&(t=t.split(",")[0]),t=this.preprocessFontFamily(t),this.fontFamilyMap[t]}});