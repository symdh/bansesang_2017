TrexConfig.addSidebar("attachbox",{show:_FALSE,destroy:_FALSE}),Trex.AttachBox=Trex.Class.create({$extend:Trex.EntryBox,isChecked:_FALSE,initialize:function(){},checkAvailableCapacity:function(){return _TRUE},getAvailableCapacity:function(){return _TRUE},checkInsertableSize:function(){return _TRUE}}),Trex.install("editor.getAttachBox & sidebar.getAttachments",function(t,e,n,a,o){var r=new Trex.AttachBox(o,t);n.entryboxRegistry.attachbox=r,t.getAttachBox=function(){return r},n.getAttachments=r.getEntries.bind(r)}),Trex.register("filter > attachers",function(t){var e=t.getAttachBox(),n=t.getDocParser();n.registerFilter("filter/attachments",{"text@load":function(t){var n=e.datalist;return n.each(function(e){e.loadDataByContent&&e.loadDataByContent("text@load",t),t=e.getChangedContent(t,e.regLoad,"")}),t},"source@load":function(t){var n=e.datalist;return n.each(function(e){e.loadDataByContent&&e.loadDataByContent("source@load",t),t=e.getChangedContent(t,e.regLoad,e.dispText)}),t},"html@load":function(t){var n=e.datalist;return n.each(function(e){e.loadDataByContent&&e.loadDataByContent("html@load",t),t=e.getChangedContent(t,e.regLoad,e.dispHtml)}),t},text4save:function(t){var n=e.datalist;return n.each(function(e){e.loadDataByContent&&e.loadDataByContent("text4save",t),t=e.getChangedContent(t,e.regText,"")}),t},source4save:function(t){var n=e.datalist;return n.each(function(e){e.loadDataByContent&&e.loadDataByContent("source4save",t),t=e.getChangedContent(t,e.regText,e.saveHtml,["id","class"])}),t},html4save:function(t){var n=e.datalist;return n.each(function(e){e.loadDataByContent&&e.loadDataByContent("html4save",t),t=e.getChangedContent(t,e.regHtml,e.saveHtml,["id","class"])}),t},text2source:function(t){return t},text2html:function(t){return t},source2text:function(t){var n=e.datalist;return n.each(function(e){e.loadDataByContent&&e.loadDataByContent("source2text",t),t=e.getChangedContent(t,e.regText,"")}),t},source2html:function(t){var n=e.datalist;return n.each(function(e){e.loadDataByContent&&e.loadDataByContent("source2html",t),t=e.getChangedContent(t,e.regText,e.dispHtml)}),t},html2text:function(t){var n=e.datalist;return n.each(function(e){e.loadDataByContent&&e.loadDataByContent("html2text",t),t=e.getChangedContent(t,e.regHtml,"")}),t},html2source:function(t){var n=e.datalist;return n.each(function(e){e.loadDataByContent&&e.loadDataByContent("html2source",t),t=e.getChangedContent(t,e.regHtml,e.dispText,["id","class"])}),t}})}),Trex.module("push history @when entrybox has changes",function(t,e,n,a){var o=t.getAttachBox();o.observeJob(Trex.Ev.__ENTRYBOX_ENTRY_REMOVED,function(t){a.history.saveHistory({deleted:_FALSE},{deleted:_TRUE},function(e){t.deletedMark=e.deleted,o.fireJobs(Trex.Ev.__ENTRYBOX_ENTRY_REFRESH,t)})});var r=function(t){$tx.msie?setTimeout(function(){t()},0):t()};o.observeJob(Trex.Ev.__ENTRYBOX_ENTRY_ADDED,function(t){r(function(){a.history.injectHistory({deleted:_TRUE},{deleted:_FALSE},function(e){t.deletedMark=e.deleted,o.fireJobs(Trex.Ev.__ENTRYBOX_ENTRY_REFRESH,t)})})})});