Trex.Canvas.Bookmark=Trex.Class.create({startContainer:_NULL,startOffset:0,endContainer:_NULL,endOffset:0,initialize:function(t){this.processor=t,this.win=t.win,this.doc=t.doc,this.dummy=function(){return t.newDummy()}},collapse:function(t){t?this.updateEnd(this.startContainer,this.startOffset):this.updateStart(this.endContainer,this.endOffset)},save:function(t){this.updateStart(t.startContainer,t.startOffset),this.updateEnd(t.endContainer,t.endOffset)},saveAroundNode:function(t){this.updateStartBefore($tom.top(t)),this.updateEndAfter($tom.bottom(t))},saveIntoFirst:function(t){var e=$tom.top(t);this.updateEndBefore(e),this.collapse(_FALSE)},saveIntoLast:function(t){var e=$tom.bottom(t);this.updateEndBefore(e),this.collapse(_FALSE)},savePreviousTo:function(t){if($tom.previous(t)){var e=$tom.top($tom.previous(t));this.updateEndAfter(e)}else this.updateEndBefore(t);this.collapse(_FALSE)},saveNextTo:function(t){if($tom.next(t)){var e=$tom.top($tom.next(t));this.updateEndBefore(e)}else this.updateEndAfter(t);this.collapse(_FALSE)},saveWithMarker:function(t){t.checkCollapsed()?(this.updateEndAfter(t.endMarker),this.collapse(_FALSE)):(this.updateStartBefore(t.startMarker),this.updateEndAfter(t.endMarker))},select:function(t){if(this.isValid()){var e=t.createTextRange();try{t.setStart(e,this.startContainer,this.startOffset),t.setEnd(e,this.endContainer,this.endOffset)}catch(t){console.log(t)}t.selectRange(e)}this.reset()},isValid:function(){return this.isValidStartContainer()&&this.isValidEndContainer()},isValidStartContainer:function(){return this.doc.body===$tom.body(this.startContainer)},isValidEndContainer:function(){return this.doc.body===$tom.body(this.endContainer)},updateStart:function(t,e){this.startContainer=t,this.startOffset=e},updateStartBefore:function(t){var e=this.dummy();$tom.insertAt(e,t),this.startContainer=e,this.startOffset=0},updateStartAfter:function(t){var e=this.dummy();$tom.insertNext(e,t),this.startContainer=e,this.startOffset=0},updateEnd:function(t,e){this.endContainer=t,this.endOffset=e},updateEndBefore:function(t){var e=this.dummy();t.nodeName&&"P"==t.nodeName.toUpperCase()&&!t.nodeValue?$tom.append(t,e):$tom.insertAt(e,t),this.endContainer=e,this.endOffset=e.length},updateEndAfter:function(t){var e=this.dummy();$tom.insertNext(e,t),this.endContainer=e,this.endOffset=e.length},reset:function(){this.startContainer=_NULL,this.startOffset=0,this.endContainer=_NULL,this.endOffset=0}});