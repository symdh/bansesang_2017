Trex.Editor=Trex.Class.create({$mixins:[Trex.I.JobObservable,Trex.I.KeyObservable],toolbar:_NULL,sidebar:_NULL,canvas:_NULL,config:_NULL,initialConfig:_NULL,initialize:function(t){this.initialConfig=t;var i=this,e=this.config=TrexConfig.setup(t),o=this.canvas=new Trex.Canvas(i,e),r=this.toolbar=new Trex.Toolbar(i,e),n=this.sidebar=new Trex.Sidebar(i,e);Trex.invokeInstallation(i,r,n,o,e);var E=e.events,s=function(t){E.useHotKey&&i.fireKeys(t)};$tx.observe(_DOC,"keydown",s.bindAsEventListener(this),_FALSE),o.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){var t=(new Date).getTime(),e=Math.round((t-Editor.initStartTime)/100)/10;i.fireJobs(Trex.Ev.__IFRAME_LOADING_TIME,e);var r=i.getInitializedId(),n=$tx("tx_loading"+r);n&&(o.mode!=Trex.Canvas.__WYSIWYG_MODE&&o.fireJobs(Trex.Ev.__CANVAS_MODE_INITIALIZE,Trex.Canvas.__WYSIWYG_MODE,o.mode),$tx.hide(n))}),Trex.invokeRegisters(i,r,n,o,e),Trex.invokeModules(i,r,n,o,e)},getToolbar:function(){return this.toolbar},getSidebar:function(){return this.sidebar},getCanvas:function(){return this.canvas},getUsedWebfont:function(){return this.canvas.getUsedWebfont()},getConfig:function(){return this.config},getInitialConfig:function(){return this.initialConfig},getParam:function(t){var i={},e=this.config;return e.params.each(function(t){e[t]&&(i[t]=e[t])}),i[t]},getWrapper:function(){if(!this.initialConfig.wrapper)throw new Error("`wrapper` config variable should be provided");return $must(this.initialConfig.wrapper)},getInitializedId:function(){return this.initialConfig.initializedId||""},saveEditor:function(){this.setDisableUnloadHandler(),this.getSaver().submit()},loadEditor:function(t){this.getSaver().load(t)},getContent:function(){return this.getSaver().getContent()},getAttachments:function(t,i){return this.getSaver().getAttachments(t,i)},getEmbeddedData:function(t){return this.getSaver().getEmbeddedData(t)},getResults:function(t){return this.getSaver().getResults(t)},getAutosaveSeq:function(){return this.getAutoSaver&&this.getAutoSaver()?this.getAutoSaver().getCurSeq():"0"}}),function(){_WIN.Editor=Trex.Class.create({$const:{__ACTIVE:_FALSE,__PANEL_LOADED:_FALSE,__EDITOR_LOADED:_FALSE,__MULTI_LIST:[],__SELECTED_INDEX:0},_initEditor:function(t,i){Editor.__EDITOR_LOADED=_FALSE,Editor.__PANEL_LOADED=_FALSE,t=new Trex.Editor(i);var e=t.getInitializedId();if(e!=_NULL){var o=""==e?0:e;Editor.__MULTI_LIST[o]=t,Editor.__SELECTED_INDEX=o}Object.extend(Editor,t),Editor.__EDITOR_LOADED=_TRUE,Editor.__ACTIVE=_TRUE},initialize:function(t){Trex.hmailLogging&&Trex.hmailLogging(t),Editor.initStartTime=(new Date).getTime();var i=null;if(_WIN.DEBUG)this._initEditor(i,t);else try{this._initEditor(i,t)}catch(t){if(!i)throw"failed to initialize editor. caused by "+t;throw i.fireJobs(Trex.Ev.__RUNTIME_EXCEPTION,t),t}}}),Editor.modify=function(t){Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED?this.loadEditor&&this.loadEditor(t):setTimeout(this.modify.bind(this,t),10)},Editor.restore=function(t){Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED?this.getAutoSaver&&this.getAutoSaver()&&this.getAutoSaver().load(t):setTimeout(this.restore.bind(this,t),10)},Editor.save=function(){return Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED?this.saveEditor&&this.saveEditor():setTimeout(this.saveEditor.bind(this),10),_FALSE},Editor.focus=function(){if(Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED){var t=this.getCanvas();t&&t.focus()}else setTimeout(this.focus.bind(this),10);return _FALSE},Editor.focusOnTop=function(){if(Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED){var t=this.getCanvas();t&&t.focusOnTop()}else setTimeout(this.focusOnTop.bind(this),10);return _FALSE},Editor.focusOnBottom=function(){if(Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED){var t=this.getCanvas();t&&t.focusOnBottom()}else setTimeout(this.focusOnBottom.bind(this),10);return _FALSE},Editor.permitUnload=function(){Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED?this.setDisableUnloadHandler():setTimeout(this.permitUnload.bind(this),500)},Editor.onPanelLoadComplete=function(t){Editor.__PANEL_LOADED==_TRUE&&Editor.__EDITOR_LOADED==_TRUE?t&&t():setTimeout(Editor.onPanelLoadComplete.bind(Editor,t),500)},Editor.switchEditor=function(t){Editor.__SELECTED_INDEX=t,Object.extend(Editor,Editor.__MULTI_LIST[t])},Editor.editorForAsyncLoad=Editor,Editor.forEachEditor=function(t){var i,e=Editor.__MULTI_LIST;for(i in e)e.hasOwnProperty(i)&&t(e[i])},Editor.focusOnForm=function(t){if(Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED){_WIN.focus();var i=Editor.getForm();i.getElementByName(t)&&i.getElementByName(t).focus()}else setTimeout(Editor.focusOnForm.bind(Editor,t),500);return _FALSE},Editor.fromHdrive=function(t){for(var i=[],e=0;e<t.length;e++)i.push(t[e]);var o={content:"",attachments:i};if(Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED){if(this.loadEditor){this.loadEditor(o);for(var r=Editor.getAttachBox().datalist,n=0;n<r.length;n++)r[n].execAppend()}}else setTimeout(this.fromHdrive.bind(this,t),10)},Editor.refreshSize=function(){this.canvas.fireJobs(Trex.Ev.__CANVAS_WRAP_WIDTH_CHANGE)},Editor.prototype.switchEditor=Editor.switchEditor,Editor.prototype.focusOnForm=Editor.focusOnForm}();