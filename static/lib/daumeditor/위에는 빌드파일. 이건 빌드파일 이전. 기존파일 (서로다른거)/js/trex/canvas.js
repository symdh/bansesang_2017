!function(e){var t=new $tx.Set(13,8,32,33,34,37,38,39,40,46),i=function(e){return t.contains(e)};TrexConfig.add({canvas:{doctype:"auto",mode:["text","html","source"],styles:{color:"#333333",fontFamily:"돋움",fontSize:"9pt",backgroundColor:"#ffffff",lineHeight:"1.5",padding:"8px"},pMarginZero:!0,selectedMode:"html",readonly:_FALSE,initHeight:400,minHeight:200,ext:"html",param:"",newlinepolicy:"p",showGuideArea:_TRUE,convertingText:_TRUE,escapeTextModeContents:_TRUE,removeTextModeBr:_FALSE,respectVisibilityInDesign:_TRUE}},function(t){var i=TrexConfig.get("canvas",t),n=t.events;i.initializedId=t.initializedId||"",i.useHotKey=n.useHotKey;var o=TrexConfig.getTool("switcher",t);e.available(o,"switcher"+i.initializedId)&&(i.mode=o.options.pluck("data"));var s=TrexConfig.getTool("fontfamily",t);e.available(s,"fontfamily"+i.initializedId)&&s.webfont&&s.webfont.use&&(i.webfont=s.webfont,i.webfont.options.each(function(e){e.url=TrexConfig.getUrl(e.url)}));var r=TrexConfig.get("resizer",t);r&&(i.minHeight=r.minHeight),i.wysiwygUrl=TrexConfig.getUrl([i.wysiwygPath||"#host#path/pages/daumx/","wysiwyg_",i.serviceWysiwyg||"","html"==i.doctype?"html":"xhtml",".",i.ext?i.ext:"html","?prefix="+t.initializedId,"&",i.param].join("")),"auto"==i.doctype&&($tx.msie&&$tx.msie_quirks?i.doctype="quirks":i.doctype="edge")}),TrexConfig.add({size:{}}),e.Canvas=e.Class.create({$const:{__TEXT_MODE:"text",__HTML_MODE:"source",__WYSIWYG_MODE:"html",__WYSIWYG_PADDING:8,__IMAGE_PADDING:5},$mixins:[e.I.JobObservable,e.I.KeyObservable,e.I.ElementObservable,e.I.MouseoverObservable],editor:_NULL,elContainer:_NULL,config:_NULL,history:_NULL,panels:_NULL,initialize:function(t,i){this.editor=t;var n=this.config=TrexConfig.get("canvas",i),o=i.initializedId?i.initializedId:"";this.elContainer=$tx("tx_canvas"+o),this.wysiwygEl=$tx("tx_canvas_wysiwyg_holder"+o),this.sourceEl=$tx("tx_canvas_source_holder"+o),this.textEl=$tx("tx_canvas_text_holder"+o),this.initConfig(i),this.createPanel(),this.history=new e.History(this,n),this.setCanvasSize({height:n.initHeight})},initConfig:function(e){var t=this.config;this.getRootConfig=function(){return e},this.getConfig=function(){return t},this.getStyleConfig=function(e){return e?t.styles[e]:t.styles};var i=TrexConfig.get("size",e);this.measureWrapWidth=function(){i.wrapWidth=this.getContainerWidth()},this.measureWrapWidth(),i.contentWidth||(i.contentWidth=i.wrapWidth),i.contentPadding=t.styles.padding.parsePx(),this.getSizeConfig=function(){return i}},getContainerWidth:function(){return $tx.getDimensions(this.elContainer).width},createPanel:function(){var t=this,i=this.config;this.panels={},this.mode=i.selectedMode||e.Canvas.__WYSIWYG_MODE,this._isForceTextMode()&&(this.mode=e.Canvas.__TEXT_MODE);var n={text:function(i){return new e.Canvas.TextPanel(t,i)},source:function(i){return new e.Canvas.HtmlPanel(t,i)},html:function(i){return new e.Canvas.WysiwygPanel(t,i)}};i.mode.each(function(e){n[e]&&(t.panels[e]=n[e](i))});for(var o in t.panels)this.mode==o?t.panels[o].show():t.panels[o].hide();t.observeJob("canvas.panel.iframe.load",function(i){t.fireJobs(e.Ev.__IFRAME_LOAD_COMPLETE,i)})},_isForceTextMode:function(){return $tx.ios||$tx.android},changeMode:function(t){var i=this.editor,n=this.mode;if(n!=t&&(!this._isForceTextMode()||n!=e.Canvas.__TEXT_MODE)){var o=this.panels[n],s=this.panels[t];if(!o||!s)throw new Error("[Exception]Trex.Canvas : not suppored mode");var r=o.getContent(),a=i.getDocParser().getContentsAtChangingMode(r,n,t);if(n==e.Canvas.__WYSIWYG_MODE){8===$tx.msie_ver&&o.hide(),o.setContent("");try{this.focusOnTop()}catch(e){}}try{s.setContent(a)}catch(e){return alert(" - Error: "+e.message+"\n에디터 타입 변경에 실패하였습니다.\n잘못된 HTML이 있는지 확인해주세요."),o.setContent(r),void o.show()}this.mode=t,this.fireJobs(e.Ev.__CANVAS_MODE_CHANGE,n,t),s.setPanelHeight(o.getPanelHeight()),s.show(),o.hide();try{"html"==t&&!this.getPanel("html").designModeActivated&&$tx.gecko&&(this.getPanel("html").el.contentDocument.designMode="on",this.getPanel("html").designModeActivated=_TRUE)}catch(e){throw e}}},focus:function(){this.panels[this.mode].focus()},focusOnTop:function(){this.getProcessor().focusOnTop()},focusOnBottom:function(){this.getProcessor().focusOnBottom()},getCanvasPos:function(){var e=$tx.cumulativeOffset(this.elContainer);return{x:e[0],y:e[1]}},setCanvasSize:function(e){if(!this.panels[this.mode]||!e.height)throw new Error("[Exception]Trex.Canvas : argument has no property - size.height ");this.panels[this.mode].setPanelHeight(e.height)},canHTML:function(){return this.isWYSIWYG()},isWYSIWYG:function(){return this.mode===e.Canvas.__WYSIWYG_MODE},getPanel:function(e){return this.panels[e]?this.panels[e]:_NULL},getCurrentPanel:function(){return this.panels[this.mode]?this.panels[this.mode]:_NULL},getProcessor:function(e){return e?this.panels[e].getProcessor():this.panels[this.mode].getProcessor()},getContent:function(){var t=this.panels[this.mode].getContent();return t&&(t=t.replace(e.__WORD_JOINER_REGEXP,"")),t},getScrollTop:function(){return this.isWYSIWYG()?this.panels[this.mode].getScrollTop():0},setScrollTop:function(e){this.isWYSIWYG()&&this.panels[this.mode].setScrollTop(e)},setContent:function(e){this.panels[this.mode].setContent(e),this.includeWebfontCss(e)},initContent:function(t){this.history.initHistory({content:t}),this.panels[this.mode].setContent(t),this.includeWebfontCss(t),this.fireJobs(e.Ev.__CANVAS_DATA_INITIALIZE,e.Canvas.__WYSIWYG_MODE,_NULL)},includeWebfontCss:function(e){if(this.isWYSIWYG())return this.panels[this.mode].includeWebfontCss(e)},getUsedWebfont:function(){return this.isWYSIWYG()?this.panels[this.mode].getUsedWebfont():[]},runScript:function(e){return this.isWYSIWYG()?void this.panels[this.mode].runScript(e):[]},importScript:function(e,t){return this.isWYSIWYG()?void this.panels[this.mode].importScript(e,t):[]},query:function(e){if(!this.isWYSIWYG())return _NULL;var t=this.getProcessor();return e(t)},execute:function(e){var t=this.history,i=this.getProcessor();this.isWYSIWYG()?(this.getPanel("html").ensureFocused(),i.restoreRange?setTimeout(function(){i.restoreRange(),e(i),t.saveHistory(),i.restore()},0):(i.focus(),e(i),t.saveHistory(),i.restore())):e(i)},moveCaret:function(e){e&&this.isWYSIWYG()&&this.getProcessor().moveCaretWith(e)},pasteContent:function(e,t,i){t=t||_FALSE,this.execute(function(n){n.pasteContent(e,t,i)})},pasteNode:function(e,t,i){this.isWYSIWYG()&&(t=t||_FALSE,this.execute(function(n){n.pasteNode(e,t,i)}))},addStyle:function(e){this.panels[this.mode].addStyle(e)},getStyle:function(e){return this.panels[this.mode].getStyle(e)},getPositionByNode:function(e){return this.isWYSIWYG()?this.panels[this.mode].getPositionByNode(e):{x:0,y:0,width:0,height:0}},onKeyDown:function(t){function i(){var e=goog.dom.Range.createFromBrowserSelection(o.getSelection?o.getSelection():n.getSel()),t=e.getStartNode(),i=e.getStartOffset();return{node:t,offset:i}}var n=this.getProcessor(),o=this.getCurrentPanel().getDocument(),s=i();this.fireJobs(e.Ev.__CANVAS_PANEL_KEYDOWN,t);var r=null;t.keyCode==e.__KEY.BACKSPACE&&n.isCollapsed()&&(r=$tom.prevNodeUntilTagName(s.node,s.offset,"table"))&&$tom.isTagName(r,"table")&&($tx.stop(t),this.fireJobs(e.Ev.__CANVAS_PANEL_BACKSPACE_TABLE,r)),this.config.useHotKey&&this.fireKeys(t),$tx.msie&&11==$tx.msie_ver&&t.keyCode==e.__KEY.ENTER&&setTimeout(this._ie11Enterbug.bind(this),20)},_ie11Enterbug:function(){var e=this.getProcessor();if(e.isCollapsed()){var t=this.getCurrentPanel().getDocument(),i=goog.dom.Range.createFromBrowserSelection(t.getSelection?t.getSelection():e.getSel()),n=i.getStartNode();if(n&&1===n.nodeType&&""===n.textContent.replace(/[ \f\n\r\t\v]/g,"")){var o=e.newDummy(!1);i.insertNode(o,!0),i.select()}}},onKeyUp:function(t){var n=t.keyCode+"";i(n)&&this.getProcessor().clearDummy(),this.history.saveHistoryByKeyEvent(t);try{this.mayAttachmentChanged=_TRUE,this.fireJobs(e.Ev.__CANVAS_PANEL_KEYUP,t),this.isWYSIWYG()&&i(n)&&this.triggerQueryStatus(),n!==e.__KEY.DELETE&&n!==e.__KEY.BACKSPACE||this.fireJobs(e.Ev.__CANVAS_PANEL_DELETE_SOMETHING)}catch(e){}},onMouseOver:function(t){try{this.fireMouseover($tx.element(t)),this.fireJobs(e.Ev.__CANVAS_PANEL_MOUSEOVER,t)}catch(e){}},onMouseMove:function(t){try{this.fireJobs(e.Ev.__CANVAS_PANEL_MOUSEMOVE,t)}catch(e){}},onMouseOut:function(t){try{this.fireJobs(e.Ev.__CANVAS_PANEL_MOUSEOUT,t)}catch(e){}},onMouseDown:function(t){this.getProcessor().clearDummy();try{this.fireElements($tx.element(t))}catch(e){}this.fireJobs(e.Ev.__CANVAS_PANEL_MOUSEDOWN,t);var i=this.history;i.saveHistoryIfEdited()},onMouseUp:function(t){try{var i=this;i.fireJobs(e.Ev.__CANVAS_PANEL_MOUSEUP,t),setTimeout(function(){var t=i.getProcessor().createGoogRange();t&&i.fireJobs(e.Ev.__CANVAS_PANEL_QUERY_STATUS,t)},20)}catch(e){}},mayAttachmentChanged:_FALSE,onClick:function(t){this.fireJobs(e.Ev.__CANVAS_PANEL_CLICK,t)},onDoubleClick:function(t){this.fireJobs(e.Ev.__CANVAS_PANEL_DBLCLICK,t)},onScroll:function(t){this.fireJobs(e.Ev.__CANVAS_PANEL_SCROLLING,t)},onPaste:function(t){this.fireJobs(e.Ev.__CANVAS_PANEL_PASTE,t)},triggerQueryStatus:function(){this.cancelReservedQueryStatusTrigger(),this.reserveQueryStatusTrigger()},reserveQueryStatusTrigger:function(){var t=this;this.reservedQueryStatusTrigger=setTimeout(function(){var i=t.getProcessor().createGoogRange();i&&(t.fireJobs(e.Ev.__CANVAS_PANEL_QUERY_STATUS,i),t.fireElements(t.getProcessor().getNode()))},20)},cancelReservedQueryStatusTrigger:function(){this.reservedQueryStatusTrigger&&clearTimeout(this.reservedQueryStatusTrigger)},syncProperty:function(){this.triggerQueryStatus()}})}(Trex),Trex.module("bind canvas events for close external menus",function(e,t,i,n){var o=function(){e.fireJobs(Trex.Ev.__SHOULD_CLOSE_MENUS)};n.observeJob(Trex.Ev.__CANVAS_PANEL_CLICK,o),n.observeJob(Trex.Ev.__CANVAS_SOURCE_PANEL_CLICK,o),n.observeJob(Trex.Ev.__CANVAS_TEXT_PANEL_CLICK,o)}),Trex.module("make getter for 'iframeheight' and 'iframetop' size",function(e,t,i,n){function o(){var e=n.getPanel(Trex.Canvas.__WYSIWYG_MODE);s=e.getPanelHeight().parsePx();var t=$tom.getPosition(e.el);r=t.y}var s=0,r=0;n.observeJob(Trex.Ev.__CANVAS_HEIGHT_CHANGE,function(e){o()}),n.observeJob(Trex.Ev.__CANVAS_FULL_SCREEN_CHANGE,function(){o()}),n.observeJob(Trex.Ev.__CANVAS_NORMAL_SCREEN_CHANGE,function(){o()}),n.observeJob("canvas.apply.background",function(){o()}),n.observeJob("canvas.apply.letterpaper",function(){o()}),n.reserveJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){o()},300);var a=e.getAttachBox();a.observeJob(Trex.Ev.__ATTACHBOX_FULLSCREEN_SHOW,function(){o()}),a.observeJob(Trex.Ev.__ATTACHBOX_FULLSCREEN_HIDE,function(){o()}),$tx.observe(_WIN,"resize",function(){o()}),n.getIframeHeight=function(){return s},n.getIframeTop=function(){return r}}),Trex.module("sync attachment data periodically",function(e,t,i,n){setTimeout(function(){setInterval(function(){n.mayAttachmentChanged&&(n.fireJobs(Trex.Ev.__CANVAS_PANEL_DELETE_SOMETHING),n.mayAttachmentChanged=_FALSE)},3e3)},1e4)}),Trex.module("synchronize the font style when caret is in end of paragraph",function(e,t,i,n){$tx.gecko&&n.observeJob(Trex.Ev.__CANVAS_PANEL_MOUSEUP,function(e){if(n.isWYSIWYG()){var t=e.target,i=t instanceof HTMLParagraphElement,o=t instanceof HTMLHtmlElement;if(!i&&!o)return;var s=n.getProcessor(),r=e.pageX,a=e.pageY,c=s.doc.caretPositionFromPoint(r,a),h=c&&c.offsetNode,_=h&&$tom.descendants(h,"#text");if(!_||!_.length)return;var u=_[_.length-1];if(u){var f=s.createGoogRangeFromNodes(u,u.length,u,u.length);f.select()}}})}),Trex.module("apply respectVisibilityInDesign for old IE",function(e,t,i,n,o){function s(){if(n.isWYSIWYG()){var e=n.getProcessor(),t=e.doc.queryCommandState(a),i=n.config.respectVisibilityInDesign;t!=i&&(e.doc.execCommand(a,!1,i),console.log("RespectVisibilityInDesign ",i))}}var r=$tx.msie&&$tx.msie_docmode<9;r&&n.observeJob(Trex.Ev.__CANVAS_MODE_CHANGE,function(e,t){s()}),r&&n.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(e){s()});var a="RespectVisibilityInDesign"});