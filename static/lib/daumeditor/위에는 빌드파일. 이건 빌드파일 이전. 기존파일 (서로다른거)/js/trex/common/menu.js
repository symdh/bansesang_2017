TrexMessage.addMsg({"@menu.pallete.enter":"입력","@menu.pallete.more":"더보기"}),Trex.Menu=Trex.Class.create({$mixins:[Trex.I.JobObservable],isInit:_FALSE,isDisplayed:_FALSE,_command:function(){},setCommand:function(e){this._command=e},initialize:function(e){var t,i=this.config=e;if(i.el){if(t=i.el,!t)throw new Error("[Exception]Trex.Menu : not exist element("+i.el+")")}else{var s=i.id,n=i.initializedId?i.initializedId:"";if(!s){if(!i.identity)throw new Error("[Exception]Trex.Menu : not exist config - id");s="tx_"+i.identity+"_menu"}if(t=$tx(s+n),!t)throw new Error("[Exception]Trex.Menu : not exist element("+s+")")}this.elMenu=t,i.top&&(t.style.top=i.top+"px"),i.left&&(t.style.left=i.left+"px"),this.oninitialized&&this.oninitialized.bind(this)(e),this.ongenerated&&(this.generateHandler=this.ongenerated.bind(this)),this.onregenerated&&(this.regenerateHandler=this.onregenerated.bind(this))},generate:function(e){if(this.generateHandler){var t=this.config;this.generateHandler(t,e)}},regenerate:function(e){if(this.initHandler&&this.initHandler(),this.regenerateHandler){var t=this.config;this.regenerateHandler(t,e)}},getValidOptions:function(e){return e.options.findAll(function(e){return!e.expired})},onSelect:function(){var e=$A(arguments),t=e.shift();this._command.apply(this,e),this.hide(),$tx.stop(t)},onCancel:function(){this.cancelHandler&&this.cancelHandler(),this.hide()},visible:function(){return this.isDisplayed},show:function(e){$tx.show(this.elMenu),this.isInit?this.regenerate(e):this.config.listseturl?this.lazyGenerate(e):(this.generate(e),this.isInit=_TRUE,this.regenerate(e)),this.showSpecial&&this.showSpecial(),this.isDisplayed=_TRUE,this.fireJobs(Trex.Ev.__MENU_LAYER_SHOW,{detail:{menu:this}})},lazyGenerate:function(e){var t=this;new(Trex.Class.create({$mixins:[Trex.I.JSRequester],initialize:function(){this.importScript(t.config.listseturl,"utf-8",_DOC,function(){t.generate(),t.isInit=_TRUE,t.regenerate(e)})}}))},hide:function(){$tx.hide(this.elMenu),this.isDisplayed=_FALSE,this.fireJobs(Trex.Ev.__MENU_LAYER_HIDE,{detail:{menu:this}})},toggle:function(){this.isDisplayed?this.hide():this.show()},release:function(e){this.isInit&&this.hide(e)}}),Trex.MarkupTemplate.add("menu.select",'<ul class="tx-menu-list" unselectable="on">#{items}</ul>'),Trex.MarkupTemplate.add("menu.select.item",'<li class="tx-menu-list-item"><a class="#{klass}" href="javascript:;" unselectable="on">#{label}</a></li>'),Trex.Menu.Select=Trex.Class.create({$extend:Trex.Menu,generate:function(){var e=this.config,t=this.getValidOptions(e),i=this.generateList(t);$tom.insertFirst(this.elMenu,i),this.generateHandler&&this.generateHandler(e),this.ongeneratedList&&(this.generateList=this.ongeneratedList.bind(this)),this.ongeneratedListItem&&(this.generateListItem=this.ongeneratedListItem.bind(this))},generateList:function(e){for(var t=Trex.MarkupTemplate.get("menu.select").evaluateAsDom({items:this.generateListItem(e)}),i=$tom.collectAll(t,"li a"),s=0;s<e.length;s++){var n=e[s],a=i[s];$tx.observe(a,"click",this.onSelect.bindAsEventListener(this,n.data,n.title))}return t},generateListItem:function(e){for(var t=[],i=0;i<e.length;i++)t.push(Trex.MarkupTemplate.get("menu.select.item").evaluate(e[i]));return t.join("")},onSelect:function(){var e=$A(arguments),t=e.shift();this._command.apply(this,e),this.hide(),$tx.stop(t)}}),Trex.MarkupTemplate.add("menu.items",['<table unselectable="on"><tbody>',"\t#{for:row}<tr>",'\t\t#{for:col}<td class="tx-menu-list-item">','<a href="javascript:;"><span class="#{klass}">','#{if:image!=""}<img src="#{image}" data="#{data}"/>#{/if:image}','#{if:image=""}#{data}#{/if:image}',"</span></a>","\t\t</td>#{/for:col}","\t</tr>#{/for:row}","</tbody></table>"].join("")),Trex.MarkupTemplate.add("menu.list",['<div class="tx-menu-inner">','\t<div class="tx-menu-list">',"   \t#{items}","    </div>","</div>"].join("")),Trex.Menu.List=Trex.Class.create({$extend:Trex.Menu,generate:function(){var e=this.config,t=this.getValidOptions(e);this.cols=e.cols||1,this.rows=e.rows||t.length;var i=this.generateList(t);$tom.insertFirst(this.elMenu,i),this.ongeneratedList&&(this.generateList=this.ongeneratedList.bind(this)),this.ongeneratedListItem&&(this.generateListItem=this.ongeneratedListItem.bind(this)),this.generateHandler&&this.generateHandler(e)},generateList:function(e){var t=Trex.MarkupTemplate.splitList(this.rows,this.cols,e),i=Trex.MarkupTemplate.get("menu.list").evaluateAsDom({items:Trex.MarkupTemplate.get("menu.items").evaluate(t)});return $tx.observe(i,"click",this.onSelect.bindAsEventListener(this)),$tx.observe(i,"mouseover",this.onItemMouseOver.bindAsEventListener(this)),$tx.observe(i,"mouseout",this.onItemMouseOut.bindAsEventListener(this)),i},onItemMouseOver:function(e){var t=$tx.findElement(e,"span");t.tagName&&"span"==t.tagName.toLowerCase()&&$tx.addClassName(t,"tx-item-hovered"),$tx.stop(e)},onItemMouseOut:function(e){var t=$tx.findElement(e,"span");t.tagName&&"span"==t.tagName.toLowerCase()&&$tx.removeClassName(t,"tx-item-hovered"),$tx.stop(e)},onSelect:function(e){var t=$tx.findElement(e,"span");if(t.tagName&&"span"==t.tagName.toLowerCase()){var i;i=t.firstChild&&1==t.firstChild.nodeType&&"img"==t.firstChild.tagName.toLowerCase()?$tom.getAttribute(t.firstChild,"data")||"":t.innerText,this._command(i),this.hide()}$tx.stop(e)}}),Trex.MarkupTemplate.add("menu.matrix",['<div class="tx-menu-inner">','\t<ul class="tx-menu-matrix-title">','\t\t#{for:matrices}<li class=""><a href="javascript:;" class="tx-menu-matrix-title-item">#{title}</a></li>#{/for:matrices}',"\t</ul>",'\t<div class="tx-menu-matrix-listset">','   \t#{for:matrices}<div class="tx-menu-matrix-list #{klass}">',"       \t#{items}","\t\t</div>#{/for:matrices}","    </div>","</div>"].join("")),Trex.Menu.Matrix=Trex.Class.create({$extend:Trex.Menu,generate:function(){var e=this.config,t=this.matrices=e.matrices.findAll(function(e){return!e.onlyIE||$tx.msie});this.cols=e.cols||10,this.rows=e.rows||5;var i=this.generateMatrix(t);$tom.insertFirst(this.elMenu,i),this.ongeneratedList&&(this.generateList=this.ongeneratedList.bind(this)),this.ongeneratedListItem&&(this.generateListItem=this.ongeneratedListItem.bind(this)),this.generateHandler&&this.generateHandler(e),this.showTab()},regenerate:function(){if(this.showTab(),this.regenerateHandler){var e=this.config;this.regenerateHandler(e)}},showTab:function(){var e=this.lastElList,t=this.lastElTitleItem,i=!e||!t;i&&(e=this.defaultElListItem,t=this.defaultElTitleItem),this.onTitleClick(_NULL,t,e)},generateMatrix:function(e){var t=this,i=this.cols,s=this.rows;e.each(function(e){var t=Trex.MarkupTemplate.splitList(s,i,e.options);e.items=Trex.MarkupTemplate.get("menu.items").evaluate(t)});var n=Trex.MarkupTemplate.get("menu.matrix").evaluateAsDom({matrices:e}),a=$tom.collectAll(n,"div.tx-menu-matrix-listset div.tx-menu-matrix-list"),r=$tom.collectAll(n,"ul.tx-menu-matrix-title li"),l=function(){for(var t=0,i=e.length;t<i;t++)if(e[t].defaultshow)return t;return 0}();this.defaultElListItem=a[l],this.defaultElTitleItem=r[l];for(var o=0;o<e.length;o++){var h=a[o];$tx.observe(h,"click",t.onSelect.bindAsEventListener(t)),$tx.observe(h,"mouseover",t.onItemMouseOver.bindAsEventListener(t)),$tx.observe(h,"mouseout",t.onItemMouseOut.bindAsEventListener(t));var m=r[o];$tx.observe(m,"click",t.onTitleClick.bindAsEventListener(t,m,h))}return n},onTitleClick:function(e,t,i){this.lastElList!=i&&($tx.show(i),this.lastElList&&$tx.hide(this.lastElList),this.lastElList=i,this.lastElTitleItem&&$tx.removeClassName(this.lastElTitleItem,"tx-selected"),$tx.addClassName(t,"tx-selected"),this.lastElTitleItem=t),e&&$tx.stop(e)},onItemMouseOver:function(e){var t=$tx.findElement(e,"span");t.tagName&&"span"==t.tagName.toLowerCase()&&$tx.addClassName(t,"tx-item-hovered"),$tx.stop(e)},onItemMouseOut:function(e){var t=$tx.findElement(e,"span");t.tagName&&"span"==t.tagName.toLowerCase()&&$tx.removeClassName(t,"tx-item-hovered"),$tx.stop(e)},onSelect:function(e){var t=$tx.findElement(e,"span");t.tagName&&"span"==t.tagName.toLowerCase()&&(this._command(t.innerText),this.hide()),$tx.stop(e)}}),Trex.MarkupTemplate.add("menu.colorPallete",['<div class="tx-menu-inner">','<ul class="tx-pallete-text-list"></ul>','<ul class="tx-pallete-thumb-list"></ul>','<p class="tx-pallete-input"><span style="background-color: rgb(7, 3, 3);"></span><input type="text" class="tx-color-value"/><a class="tx-enter">@menu.pallete.enter</a></p>','<div class="tx-pallete-buttons">','\t<p class="tx-pallete-more"><a class="tx-more-down" href="javascript:;">@menu.pallete.more</a></p>',"</div>",'<div class="tx-pallete-picker">','\t<div class="tx-pallete-pickerbox">','\t\t<div class="tx-chromabar" style="background-color: rgb(255, 0, 0);"></div><div class="tx-huebar"></div>',"\t</div>","</div>","</div>"].join("")),Trex.Menu.ColorPallete=Trex.Class.create({$extend:Trex.Menu,$mixins:[Trex.I.ColorPallete],generate:function(){var e=this.config,t=this.elMenu;Trex.MarkupTemplate.get("menu.colorPallete").evaluateToDom({},t);var i=e.thumbs.transparent;if(e.thumbs.transparent=Object.extend(e.thumbs.transparent,{image:TrexConfig.getIconPath(i.image),thumb:TrexConfig.getIconPath(i.thumb),thumbImage:TrexConfig.getIconPath(i.thumbImage)}),!this.hookEvent)throw new Error("[Exception]Trex.Menu.ColorPallete : not implement function(hookEvent)");this.hookEvent(e),this.generateHandler&&this.generateHandler(e),this.bindEvents()},onSelect:function(){var e=$A(arguments),t=e.shift();this._command.apply(this,e),this.remainColor(e),this.hide(),$tx.stop(t)},remainColor:function(e){e&&this.setColorValueAtInputbox(e)},bindEvents:function(){var e=this;$tx.observe(this.elMore,"click",function(t){e.fireJobs(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,{detail:{menu:e}})})}});