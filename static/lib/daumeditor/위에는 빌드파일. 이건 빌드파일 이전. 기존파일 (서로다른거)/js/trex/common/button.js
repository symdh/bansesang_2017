Trex.MarkupTemplate.add("button.itsnew",'<em class="tx-itsnew" title="new">new</em>'),Trex.MarkupTemplate.add("button.select.text","<span>#{data}</span>"),Trex.Button=Trex.Class.create({$const:{__borderClasses:{"tx-btn-trans":_TRUE,"tx-btn-lbg":_TRUE,"tx-btn-bg":_TRUE,"tx-btn-rbg":_TRUE,"tx-btn-lrbg":_TRUE,"tx-slt-tlbg":_TRUE,"tx-slt-tbg":_TRUE,"tx-slt-trbg":_TRUE,"tx-slt-blbg":_TRUE,"tx-slt-bbg":_TRUE,"tx-slt-brbg":_TRUE,"tx-slt-31bg":_TRUE,"tx-slt-31lbg":_TRUE,"tx-slt-31rbg":_TRUE,"tx-slt-70lbg":_TRUE,"tx-slt-70bg":_TRUE,"tx-slt-59bg":_TRUE,"tx-slt-42bg":_TRUE,"tx-slt-56bg":_TRUE,"tx-btn-nlrbg":_TRUE,"tx-btn-43lrbg":_TRUE,"tx-btn-52lrbg":_TRUE,"tx-btn-57lrbg":_TRUE,"tx-btn-71lrbg":_TRUE,"tx-btn-48lbg":_TRUE,"tx-btn-48rbg":_TRUE,"tx-btn-30lrbg":_TRUE,"tx-btn-46lrbg":_TRUE,"tx-btn-67lrbg":_TRUE,"tx-btn-49lbg":_TRUE,"tx-btn-58bg":_TRUE,"tx-btn-46bg":_TRUE,"tx-btn-49rbg":_TRUE,"tx-btn-widget":_TRUE,"tx-btn-widget-tbg":_TRUE,"tx-btn-widget-brbg":_TRUE},addBorderClass:function(t){Trex.Button.__borderClasses[t]=_TRUE},getBorderClass:function(t){for(var e=$tx.classNames(t),s=0;s<e.length;s++){var i=e[s],n=Trex.Button.__borderClasses[i];if(n)return i}}},hasState:_NULL,isDisabled:_NULL,lastValue:_NULL,lastText:_NULL,elButton:_NULL,elIcon:_NULL,borderClass:_NULL,_command:function(){},setCommand:function(t){this._command=t},initialize:function(t){var e=this.config=t;if(e.borderClass&&Trex.Button.addBorderClass(e.borderClass),this.itsNew=!!e.itsnew,this.hasState=!!e.status,this.isDisabled=_FALSE,this.lastValue=e.selectedValue||_NULL,t.el)this.elButton=t.el;else{var s=e.id||"tx_"+e.identity;this.elButton=$must(s+(e.initializedId||""))}var i=this.elButton,n=this.elIcon=$tom.collect(i,"a");if(!n)throw new Error("[Exception]Trex.Button : can't find elIcon for button '"+s+"'");this.borderClass=Trex.Button.getBorderClass(i),this.oninitialized&&this.oninitialized.bind(this)(e),this.generate(),this.itsNew&&$tom.append(n,Trex.MarkupTemplate.get("button.itsnew").evaluateAsDom({})),e.selectedValue&&this.setValue&&this.setValue(e.selectedValue),e.selectedText&&this.setText&&this.setText(e.selectedText),e.selectedState&&this.setState&&this.setState(e.selectedState)},generate:function(){var t=this.elIcon;this.hdlMouseDown=this.onMouseDown.bindAsEventListener(this),this.hdlMouseOver=this.onMouseOver.bindAsEventListener(this),this.hdlMouseOut=this.onMouseOut.bindAsEventListener(this),this.hdlKeydown=this.onKeyDown.bindAsEventListener(this),this.hdlClick=this.onClick.bindAsEventListener(this),$tx.observe(t,"mousedown",this.hdlMouseDown),$tx.observe(t,"mouseover",this.hdlMouseOver),$tx.observe(t,"mouseout",this.hdlMouseOut),$tx.observe(t,"keydown",this.hdlKeydown),$tx.observe(t,"click",this.hdlClick),this.ongenerated&&this.ongenerated.bind(this)(this.config)},removeHandler:function(){if(this.hdlMouseDown){var t=this.elIcon;$tx.stopObserving(t,"mousedown",this.hdlMouseDown),$tx.stopObserving(t,"mouseover",this.hdlMouseOver),$tx.stopObserving(t,"mouseout",this.hdlMouseOut),$tx.stopObserving(t,"keydown",this.hdlKeydown),$tx.stopObserving(t,"click",this.hdlClick)}},getCurrentBorderClass:function(t){for(var e=$tx.classNames(t),s=0;s<e.length;s++){var i=e[s];if(i.indexOf(this.borderClass)!=-1)return i}return _UNDEFINED+""},normalState:function(){var t=this.getCurrentBorderClass(this.elButton);t!=this.borderClass&&($tx.removeClassName(this.elButton,t),$tx.addClassName(this.elButton,this.borderClass))},hoveredState:function(){var t=this.getCurrentBorderClass(this.elButton);$tx.removeClassName(this.elButton,t),$tx.addClassName(this.elButton,this.borderClass+"-hovered"),this.decreaseZindex()},pushedState:function(){var t=this.getCurrentBorderClass(this.elButton);$tx.removeClassName(this.elButton,t),$tx.addClassName(this.elButton,this.borderClass+"-pushed")},currentState:function(){var t=this.getCurrentBorderClass(this.elButton),e="normal";return t.indexOf("-pushed")!=-1?e="pushed":t.indexOf("-hovered")!=-1&&(e="hovered"),e},isPushed:function(){return"pushed"==this.currentState()},hasMenu:function(){return this.tool?!!this.tool.menu:_FALSE},onMouseDown:function(t){if(t&&$tx.stop(t),!this.isDisabled){if(this.hasMenu()||this.hasState){if(this._command(t)===_FALSE)return}else this.evsessionstarted=_TRUE;this.isPushed()?this.normalState():this.pushedState()}},onMouseOver:function(){this.isDisabled||this.isPushed()||this.hoveredState()},onMouseOut:function(){this.evsessionstarted&&(this.normalState(),this.evsessionstarted=_FALSE),this.isDisabled||this.isPushed()||this.normalState()},onClick:function(t){t&&$tx.stop(t),this.isDisabled||this.hasState||(this._command(),this.normalState(),this.evsessionstarted=_FALSE)},onKeyDown:function(t){13===t.keyCode&&(this.onMouseDown(t),this.onClick(t))},updateAfterCommand:function(t,e){this.setValueAndText(t,e),this.normalState()},setValueAndText:function(t,e){this.setValue(t),this.setText(e)},setValue:function(t){t&&(this.lastValue=t)},setText:function(t){this.lastText=t},getValue:function(){return this.lastValue},getText:function(){return this.lastText},setState:function(t){t?this.pushedState():this.normalState()},setClassName:function(t){this.elIcon.className=t},disable:function(){this.elButton&&(this.isDisabled=_TRUE,$tx.addClassName(this.elButton,"tx-disable"))},enable:function(){this.elButton&&(this.isDisabled=_FALSE,$tx.removeClassName(this.elButton,"tx-disable"))},release:function(){this.isDisabled||!this.hasMenu()&&this.hasState||this.normalState()},increaseZindex:function(){var t=10;$tom.parent(this.elButton)&&$tx.setStyle($tom.parent(this.elButton),{zIndex:t})},decreaseZindex:function(){var t=4;$tom.parent(this.elButton)&&$tx.setStyle($tom.parent(this.elButton),{zIndex:t})}}),Trex.Button.Select=Trex.Class.create({$extend:Trex.Button,ongenerated:function(){Trex.MarkupTemplate.get("button.select.text").evaluateToDom({data:$tom.getText(this.elIcon)},this.elIcon),this.elText=$tom.collect(this.elIcon,"span");var t=$tom.collect(this.elButton,"a.tx-arrow");t&&($tx.observe(t,"mousedown",this.onMouseDown.bindAsEventListener(this)),$tx.observe(t,"mouseover",this.onArrowMouseOver.bindAsEventListener(this)),$tx.observe(t,"mouseout",this.onArrowMouseOut.bindAsEventListener(this)),$tx.observe(t,"click",this.onClick.bindAsEventListener(this)))},setText:function(t){this.elText.innerText=t},onArrowMouseOver:function(){this.isDisabled||this.isPushed()||this.hoveredState()},onArrowMouseOut:function(){this.isDisabled||this.isPushed()||this.normalState()}}),Trex.Button.Splits=Trex.Class.create({$extend:Trex.Button,ongenerated:function(){var t=this.elButton,e=this.elArrow=$tom.collect(t,"a.tx-arrow");if(!e)throw new Error("[Exception]Trex.Button.Splits : not exist element(a.tx-arrow)");$tx.observe(e,"mousedown",this.onArrowMouseDown.bindAsEventListener(this)),$tx.observe(e,"mouseover",this.onArrowMouseOver.bindAsEventListener(this)),$tx.observe(e,"mouseout",this.onArrowMouseOut.bindAsEventListener(this)),$tx.observe(e,"click",this.onArrowClick.bindAsEventListener(this))},arrowHoveredState:function(){var t=this.getCurrentBorderClass(this.elButton);$tx.removeClassName(this.elButton,t),$tx.addClassName(this.elButton,this.borderClass+"-arrow-hovered")},arrowPushedState:function(){var t=this.getCurrentBorderClass(this.elButton);$tx.removeClassName(this.elButton,t),$tx.addClassName(this.elButton,this.borderClass+"-arrow-pushed")},onMouseDown:function(){this.isDisabled||(this.isPushed()?(this._command(),this.normalState(),this.commandexecuted=_TRUE):(this.pushedState(),this.commandexecuted=_FALSE,this.evsessionstarted=_TRUE))},onClick:function(t){t&&$tx.stop(t),this.isDisabled||(this.commandexecuted?this.commandexecuted=_FALSE:(this.tool.execute(this.lastValue,this.lastText),this.evsessionstarted=_FALSE),this.normalState())},onArrowMouseDown:function(){this.isDisabled||this._command()!==_FALSE&&(this.isPushed()?this.normalState():this.arrowPushedState())},onArrowClick:function(t){t&&$tx.stop(t),this.isDisabled},onArrowMouseOver:function(){this.isDisabled||this.isPushed()||this.arrowHoveredState()},onArrowMouseOut:function(){this.isDisabled||this.isPushed()||(this.commandexecuted&&(this.commandexecuted=_FALSE),this.normalState())}}),Trex.Button.Toggle=Trex.Class.create({$extend:Trex.Button,setValue:function(t){t?this.pushedState():this.normalState()}}),Trex.Button.Widget=Trex.Class.create({$extend:Trex.Button.Select,setText:function(t){this.elIcon.innerText=t,this.lastText&&$tx.removeClassName(this.elIcon,this.lastText),$tx.addClassName(this.elIcon,t),this.lastText=t},setMenu:function(t,e){this.hasState=_TRUE;var s=this;t.setCommand(function(){var t=e.apply(this,arguments);return s.updateAfterCommand.apply(s,arguments),t}),s.setCommand(function(){if(s.isPushed())t.hide();else{var e=s.getValue();t.show(e)}return _TRUE})}}),Trex.Button.ColorWidget=Trex.Class.create({$extend:Trex.Button.Widget,setValue:function(t){$tx.setStyle(this.elIcon.parentNode,{backgroundColor:t}),this.lastValue=t},setText:function(){}});