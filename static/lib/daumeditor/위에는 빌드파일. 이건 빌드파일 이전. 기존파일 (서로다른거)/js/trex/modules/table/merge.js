TrexMessage.addMsg({"@table.merge.confirm":"셀을 병합하면 맨 위쪽 셀에 있는 값만 남고 나머지 값은 잃게 됩니다.","@table.merge.more.select.cells":"두 개 이상의 셀을 선택해주세요."}),Trex.Table.Merge=Trex.Class.create({initialize:function(e){var t;t=e.getCanvas(),this.wysiwygPanel=t.getPanel(Trex.Canvas.__WYSIWYG_MODE)},merge:function(e){var t,r,n;if(e.reloadIndexer(),t=e.getSelectedTdArr(),1<t.length){var l=this.isExistContents(t,1);if(l&&confirm(TXMSG("@table.merge.confirm"))==_FALSE)return;n=e.getSizeOfSelected(),r=t[0],this.deleteCellForMerge(t),this.extendCellForMerge(r,e,n),e.reset(),e.selectByTd(r,r),Trex.TableUtil.collapseCaret(this.wysiwygPanel,r)}else alert(TXMSG("@table.merge.more.select.cells"))},isExistContents:function(e,t){t=t||0;for(var r=_TRUE,n=t,l=e.length;n<l;n++){var o=e[n]||"",i=o.innerHTML.trim().toLowerCase().replace(/(&nbsp;|\s)/g,""),a="<p></p>"==i,s="<p><br></p>"==i,d=""==i;if(a||s||d){r=_FALSE;break}}return r},deleteCellForMerge:function(e){var t,r,n,l;for(t=e[0].innerHTML,l=e.length,n=1;n<l;n+=1)r=t.replace(Trex.__WORD_JOINER_REGEXP,"").trim(),""!==r&&"&nbsp;"!==r||(t=e[n].innerHTML),$tom.remove(e[n]);e[0].innerHTML=t},extendCellForMerge:function(e,t,r){var n;n=t.getSelected(),e.colSpan=n.right-n.left+1,e.rowSpan=n.bottom-n.top+1,e.style.width&&$tom.setWidth(e,r.width+"px"),e.style.height&&$tom.setHeight(e,r.height+"px")},resetMerge:function(e){var t,r;e.reloadIndexer(),t=this.splitCol(e),e.reloadIndexer(),r=this.splitRow(e),t===_FALSE&&r===_FALSE?alert("이미 합쳐진 셀만 분할 가능합니다."):e.reloadIndexer()},splitCol:function(e){var t,r,n,l,o,i;if(t=_FALSE,r=e.getSelectedTdArr(),o=r.length,0<o)for(l=0;l<o;l+=1)n=r[l],i=this.splitTdByColSpan(n),t=t||i;return t},splitRow:function(e){var t,r,n,l,o,i;if(t=_FALSE,r=e.getSelectedTdArr(),o=r.length,0<o)for(l=0;l<o;l+=1)n=r[l],i=this.splitTdByRowSpan(n),t=t||i;return t},splitTdByColSpan:function(e){var t,r,n;for(t=e.colSpan-1,n=0<t,Trex.TableUtil.splitWidthByColSpan(e),e.colSpan=1;0<t;)r=Trex.TableUtil.cloneNodeForEmptyTd(e),$tom.insertNext(r,e),t-=1;return n},splitTdByRowSpan:function(e){var t,r;for(r=e.rowSpan-1,t=0<r,Trex.TableUtil.splitHeightByRowSpan(e);0<r;)this.splitTdOneByOne(e),r-=1;return t},splitTdOneByOne:function(e){var t,r,n;t=this.getTrForInsert(e),r=this.getTdForInsert(e,t),n=Trex.TableUtil.cloneNodeForEmptyTd(e),n.rowSpan=1,e.rowSpan-=1,r?$tom.insertAt(n,r):$tom.append(t,n)},getTrForInsert:function(e){var t,r,n;for(n=$tom.parent(e),r=e.rowSpan-1,t=0;t<r;t+=1)n=$tom.next(n,"tr");return n},getTdForInsert:function(e,t){var r,n,l,o,i,a,s,d;for(r=Trex.TableUtil.getTableIndexerFromTd(e),n=r.getBoundary(e),l=n.left,o=t.cells,i=o.length,a=0;a<i;a+=1)if(s=o[a],d=r.getBoundary(s),l<=d.left)return s;return _NULL}});