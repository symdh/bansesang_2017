Trex.MarkupTemplate.add("table.col.resize.dragger",'<div class="tx-table-col-resize-dragger" style="position:absolute; overflow:hidden; top: 0; left: 0; width: 3px; height: 100%; cursor:col-resize;"></div>'),Trex.MarkupTemplate.add("table.row.resize.dragger",'<div class="tx-table-row-resize-dragger" style="position:absolute; overflow:hidden; top: 0; left: 0; width: 100%; height: 3px; cursor:row-resize;"></div>'),TrexMessage.addMsg({"@table.noselect.alert":"테이블을 선택하신 후 사용가능합니다."}),Trex.Table={},Trex.module("table selector",function(e,t,r,o,l){var n;n=function(e){var t,r,o;t=Trex.MarkupTemplate.get("table.col.resize.dragger").evaluateAsDom({}),r=Trex.MarkupTemplate.get("table.row.resize.dragger").evaluateAsDom({}),o=e.wysiwygEl,$tom.insertFirst(o,t),$tom.insertFirst(o,r),$tx.hide(t),$tx.hide(r)},o.observeJob(Trex.Ev.__CANVAS_PANEL_BACKSPACE_TABLE,function(e){$tom.remove(e)}),o.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){var r,i,s,a,c,d;r=new Trex.Table.Selector(e,l),i=new Trex.Table.Merge(e,l),s=new Trex.Table.Insert(e,l),a=new Trex.Table.Delete(e,l),c=new Trex.Table.Border(e,l),d=new Trex.Table.TemplateLoader,n(o);var g=o.getPanel(Trex.Canvas.__WYSIWYG_MODE),u=g.getProcessor(),h=function(){var e,t;r.getSelected().isValid()===_FALSE&&(e=u.getNode(),t=Trex.TableUtil.getClosestByTagNames(["td","th"],e),t&&r.selectByTd(t,t))};o.observeElement({tag:"table"},function(e){t.tools.advanced&&t.tools.advanced.forceOpen()});var T={range:"all",color:"",height:1,type:"solid"},f=function(){var e=t.tools.cellslinecolor;e&&(T.color=e.config.defaultcolor)};f();var p=function(){alert(TXMSG("@table.noselect.alert"))};u.table={getTdArr:function(){return r.getSelectedTdArr()},isDuringSelection:function(){return r.isDuringSelection()},execute:function(e,t){t||h(),r.getSelected().isValid()?(e(),o.history.saveHistory()):p()},merge:function(){this.execute(function(){i.merge(r)},_TRUE)},resetMerge:function(){this.execute(function(){i.resetMerge(r)})},insertRowAbove:function(){this.execute(function(){s.insertRowAbove(r)})},insertRowBelow:function(){this.execute(function(){s.insertRowBelow(r)})},insertColLeft:function(){this.execute(function(){s.insertColLeft(r)})},insertColRight:function(){this.execute(function(){s.insertColRight(r)})},deleteRow:function(){this.execute(function(){a.deleteRow(r)})},deleteCol:function(){this.execute(function(){a.deleteCol(r)})},setBorderRange:function(e){T.range=e},setBorderColor:function(e){T.color=e,t.fireJobs(Trex.Ev.__TOOL_CELL_LINE_CHANGE,{color:e})},setBorderHeight:function(e){T.height=e,t.fireJobs(Trex.Ev.__TOOL_CELL_LINE_CHANGE,{height:e})},setBorderType:function(e){T.type=e,t.fireJobs(Trex.Ev.__TOOL_CELL_LINE_CHANGE,{type:e})},setNoBorder:function(){var e=this;this.execute(function(){c.setTableSelect(r),c.setBorderRange("all"),c.changeBorderColor(e.getTdArr(),""),c.changeBorderHeight(e.getTdArr(),"0"),c.changeBorderType(e.getTdArr(),"none")})},setBorderButtons:function(e,r,o){var l;l=t.tools.cellslinecolor,l&&l.execute(e),l=t.tools.cellslineheight,l&&l.execute(r),l=t.tools.cellslinestyle,l&&l.execute(o)},getBorderProperty:function(){return{color:T.color,height:T.height,type:T.type}},applyBorder:function(){var e=this;this.execute(function(){c.setTableSelect(r),c.setBorderRange(T.range),c.changeBorderColor(e.getTdArr(),T.color),c.changeBorderHeight(e.getTdArr(),T.height),c.changeBorderType(e.getTdArr(),T.type),e.addBorderHistory()})},addBorderHistory:function(){var e;e=t.tools.cellslinepreview,e&&e.addBorderHistory(T)},tableBackground:function(e){var t=this;e=e||"transparent",this.execute(function(){var o,l,n,i;for(o={backgroundColor:e},l=t.getTdArr(),i=l.length,n=0;n<i;n+=1)$tx.setStyle(l[n],o);r.reset()})},setTemplateStyle:function(e,t){if(e){var o=this;d.getTemplate(t,function(t){t.apply(e),o._applyTemplateOutline(e,t.templateData),r.reset()})}else p()},_applyTemplateOutline:function(e,t){var o=t,l=this,n={top:this._parseBorderStyle(o.firstRow.borderTop),right:this._parseBorderStyle(o.lastCol.borderRight||o.common.borderRight),bottom:this._parseBorderStyle(o.lastRow.borderBottom||o.common.borderBottom),left:this._parseBorderStyle(o.firstCol.borderLeft)},i=new Trex.Tool.Table.TableCellMatrixer(e),s=i.getTdMatrix(),a=i.getRowSize(),d=i.getColSize();if(s&&s.length){r.selectByTd(s[0][0],s[a-1][d-1]),c.setTableSelect(r);var g=["top","right","bottom","left"];g.each(function(e){c.setBorderRange(e),c.changeBorderColor(l.getTdArr(),n[e].color),c.changeBorderHeight(l.getTdArr(),n[e].height),c.changeBorderType(l.getTdArr(),n[e].type)})}},_parseBorderStyle:function(e){if(e=e.trim().toLowerCase(),"none"===e)return{height:"none",type:"solid",color:"transparent"};var t=e.split(" ");return 3!=t.length&&(t=["1px","solid","#000"]),{height:t[0].parsePx()||1,type:t[1],color:t[2]}}},t.fireJobs(Trex.Ev.__TOOL_CELL_LINE_CHANGE,{color:T.color,height:T.height,type:T.type,fromInit:_TRUE}),t.observeJob(Trex.Ev.__TOOL_CLICK,function(e){["fontfamily","fontsize","bold","underline","italic","strike","forecolor","backcolor","indent","outdent","alignleft","aligncenter","alignright","alignfull","mergecells","splitcells","insertcells","deletecells","cellsoutline","cellslinecolor","cellslineheight","cellslinestyle","cellslinepreview","tablebackcolor","tabletemplate"].contains(e)===_FALSE&&r.reset(),"tablebackcolor"===e&&h()})})});