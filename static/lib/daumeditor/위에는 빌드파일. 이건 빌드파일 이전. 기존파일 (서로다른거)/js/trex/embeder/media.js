TrexConfig.addTool("media",{wysiwygonly:_TRUE,sync:_FALSE,status:_FALSE}),TrexMessage.addMsg({"@media.title":"멀티미디어","@media.prev.url":"#iconpath/spacer2.gif?v=2","@media.prev.url.tvpot":"#iconpath/img_multi_tvpot.gif?v=2","@media.prev.url.wmp":"#iconpath/spacer2.gif?v=2"}),Trex.Tool.Media=Trex.Class.create({$const:{__Identity:"media"},$extend:Trex.Tool,oninitialized:function(){var e=this.editor;this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,function(){e.getSidebar().getEmbeder("media").execute()})}}),TrexConfig.addEmbeder("media",{wysiwygonly:_TRUE,useCC:_FALSE,features:{left:250,top:65,width:458,height:568,resizable:"yes"},popPageUrl:"#host#path/pages/trex/multimedia.html",allowNetworkingFilter:_FALSE,allowNetworkingSites:[]},function(e){var t=e.sidebar.embeder.media;t.popPageUrl=TrexConfig.getUrl(t.popPageUrl),t.features=TrexConfig.getPopFeatures(t.features)}),function(){function e(e,t){var r,i,a,n;for(i="",r=/[\/]*\/\/([^\/]+)\//i.exec(e),r&&r[1]&&(i=r[1]),n=t.allowNetworkingSites.length,a=0;a<n;a+=1)if(i==t.allowNetworkingSites[a].host)return _TRUE;return _FALSE}function t(t,r){var i;return r.allowNetworkingFilter==_FALSE?t:(i=t.replace(/(<object[^>]*>)((?:\n|.)*?)(<\/object>)/gi,function(t,i,a,n){var o,c,s=_FALSE;return o=/data[\s]*=[\s"']*(http:\/\/[^\/]+\/)[^("'\s)]+/i.exec(i),o&&2==o.length&&(c=o[1],e(c,r)===_FALSE&&(s=_TRUE)),o=/<param[^>]*=[^\w]*movie[^\w]+[^>]*>/i.exec(a),o&&o[0]&&(c=/\s+value=["']?([^\s"']*)["']?/i.exec(o[0]),c&&c[1]&&e(c[1],r)===_FALSE&&(s=_TRUE)),o=/<param[^>]*=[^\w]*src[^\w]+[^>]*>/i.exec(a),o&&o[0]&&(c=/\s+value=["']?([^\s"']*)["']?/i.exec(o[0]),c&&c[1]&&e(c[1],r)===_FALSE&&(s=_TRUE)),s===_TRUE&&(a=a.replace(/<param[^>]*=[^\w]*allowNetworking[^\w]+[^>]*>/i,""),a='<param name="allowNetworking" value="internal" />'.concat(a)),i+a+n}),i=i.replace(/(<embed)([^>]*)(><\/embed>|\/>)/gi,function(t,i,a,n){var o=/\s+src=["']?([^\s"']*)["']?/i.exec(a);return o&&o[1]&&e(o[1],r)?i+a+n:(a=a.replace(/\s+allowNetworking=["']?[\w]*["']?/i,"").concat(' allowNetworking="internal"'),i+a+n)}))}function r(e){for(var t,r=new RegExp("<(?:img|IMG)[^>]*txc-media[^>]*/?>","gim"),i=e;(t=r.exec(i))!=_NULL;){var a=t[0],o=n(a);!$tx.msie&&o.indexOf("$")>-1&&(o=o.replace(/\$/g,"$$$$")),e=e.replace(a,o)}return e}function i(e){if($tx.msie){if($tx.msie_ver<10&&(e=e.replace(/<iframe[^>]*src=("|'|)https?:\/\/www\.youtube\.com\/embed\/(\w+)\1[^>]*><\/iframe>/i,function(e,t,r){var i,a,n;return i=e.match(/\swidth=['"]?(\d+)/),a=i&&i[1]||"560",i=e.match(/\sheight=['"]?(\d+)/),n=i&&i[1]||"315",'<object width="'+a+'" height="'+n+'"><param name="movie" value="https://www.youtube.com/v/'+r+'?version=3&amp;hl=ko_KR" /><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="wmode" value="transparent" /><embed src="https://www.youtube.com/v/'+r+'?version=3&amp;hl=ko_KR" type="application/x-shockwave-flash" width="'+a+'" height="'+n+'" allowscriptaccess="always" allowfullscreen="true" wmode="transparent"></embed></object>'})),/<object/.test(e)&&/<embed[^>]*type=['"]application\/x-shockwave-flash['"][^>]*>/i.test(e)&&!/<object[^>]*type=['"]application\/x-shockwave-flash['"][^>]*>/i.test(e)){var t=e.indexOf(">");e=e.substring(0,t)+' type="application/x-shockwave-flash"'+e.substring(t)}return e}for(var r,i,n,o,c=e,s=new RegExp("<(?:script)[^>]*>[\\S\\s]*?(<(?:embed|EMBED)[^>]*src=[^>]*>)[\\S\\s]*?</(?:script)>","gim");(r=s.exec(c))!=_NULL;)i=r[0],n=i.replace(/<embed/i,"<xxembed"),e=e.replace(i,n);for(var l=new RegExp("<(?:object|OBJECT)[^>]*>[\\S\\s]*?(<(?:embed|EMBED)[^>]*src=[^>]*>)[\\S\\s]*?</(?:object|OBJECT)>","gim");(r=l.exec(c))!=_NULL;)i=r[0],o=r[1],n=a(i,o),e=e.replace(i,n);for(l=new RegExp("<(?:embed|EMBED)[^>]*src=[^>]*(?:/?>|></(?:embed|EMBED)>)","gim");(r=l.exec(c))!=_NULL;)i=r[0],o=r[0],n=a(i,o),e=e.replace(i,n);return e=e.replace(/<xxembed/i,"<embed")}function a(e,t){var r=Trex.Util.getAllAttributesFromEmbed(t),i=r.src,a=r.width.isPercent()?r.width:(r.width||" ").parsePx(),n=r.height.isPercent()?r.height:(r.height||" ").parsePx();if(0===parseInt(a,10)||0===parseInt(n,10)){var o=s(i);a=o.width,n=o.height}var c="<embed";for(var m in r)r.hasOwnProperty(m)&&(c+=" "+m+'="'+r[m]+'"');c+=">";var u=e.split(t);e=u[0]+c;for(var d=1;d<u.length;d++)e+=u[d];var h=l(i);return'<img src="'+h.imageSrc+'" width="'+a+'" height="'+n+'" border="0" class="tx-entry-embed txc-media'+h.className+'" ld="'+encodeURIComponent(e)+'"/>'}function n(e){var t=Trex.Util.getAllAttributes(e),r=t.ld;if(!r||0==r.length)return"";var i=t.width,a=t.height,n=decodeURIComponent(r),o=n;if(n.indexOf("object")>-1||n.indexOf("OBJECT")>-1)for(var c,l=new RegExp("<(?:embed|EMBED)[^>]*src=[^>]*(?:/?>|></(?:embed|EMBED)>)","gim");(c=l.exec(n))!=_NULL;)o=c[0];t=Trex.Util.getAllAttributes(o);var m=t.src,u=s(m);return n=isNaN(i)?Trex.String.changeAttribute(n,"width",i,u.width):Trex.String.changeAttribute(n,"width",i,i),n=isNaN(a)?Trex.String.changeAttribute(n,"height",a,u.height):Trex.String.changeAttribute(n,"height",a,a)}function o(e){return(e.match(/http:\/\/tvpot\.daum\.net\/v\/(.{23})/)||[])[1]}function c(e){return(e.match(/(?:http:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=)?(.+)/)||[])[1]}function s(e){var t,r;if(e.indexOf("api.bloggernews.media.daum.net/static/recombox1")>-1)t=400,r=80;else if(e.indexOf("flvs.daum.net/flvPlayer")>-1)t=502,r=399;else if(e.indexOf("youtube")!=-1||e.indexOf("youtu.be")!=-1||e.indexOf("tvpot.daum.net")!=-1){var i=TrexConfig.get("size");i.contentWidth>640?(t=640,r=360):(t=560,r=315)}else{var a=e.split(".").pop().split("?")[0].toLowerCase();switch(a){case"mp3":case"wma":case"asf":case"asx":t=280,r=45;break;case"mpg":case"mpeg":case"wmv":case"avi":t=320,r=285;break;default:t=400,r=300}}return{width:t,height:r}}function l(e){var t="",r="";if(e.indexOf("api.bloggernews.media.daum.net/static/recombox1")>-1)t="",r=TXMSG("@media.prev.url");else if(e.indexOf("flvs.daum.net/flvPlayer")>-1)t=" txc-media-tvpot",r=TXMSG("@media.prev.url.tvpot");else{var i=e.split(".").pop().split("?")[0].toLowerCase();switch(i){case"mp3":case"wma":case"asf":case"asx":t=" txc-media-wmp",r=TXMSG("@media.prev.url.wmp");break;case"mpg":case"mpeg":case"wmv":case"avi":t=" txc-media-wmp",r=TXMSG("@media.prev.url.wmp");break;default:t="",r=TXMSG("@media.prev.url")}}return{className:t,imageSrc:r}}Trex.Embeder.Media=Trex.Class.create({$const:{__Identity:"media"},$extend:Trex.Embeder,name:"media",title:TXMSG("@media.title"),canResized:_TRUE,getCreatedHtml:function(e){var t=e.code||this.makeSourceByUrl(e.url);return i(t)},getDataForEntry:function(){},makeSourceByUrl:function(e){var t=this.getUrlExt(e),r=s(e);switch(t){case"swf":return this.generateHTMLForFlash(e,r);case"mp3":case"wma":case"asf":case"asx":case"mpg":case"mpeg":case"wmv":case"avi":return this.generateHTMLForMoviePlayer(e,r);case"mov":return this.generateHTMLForQuicktime(e,r);case"jpg":case"bmp":case"gif":case"png":return this.generateHTMLForImage(e,r);default:var i=this.generateHTMLIfIframeSource(e,r);return i?i:this.generateHTMLForDefaultEmbed(e,r)}},getUrlExt:function(e){return e.split(".").pop().split("?")[0].toLowerCase()},getAllowScriptAccess:function(t){var r=" allowScriptAccess='never'";return this.config.allowNetworkingFilter&&e(t,this.config)==_FALSE&&(r+=" allowNetworking='internal'"),r},generateHTMLForDefaultEmbed:function(e,t){return'<embed src="'+e+"\" width='"+t.width+"' height='"+t.height+"' "+this.getAllowScriptAccess(e)+" ></embed>"},generateHTMLForImage:function(e,t){return'<img src="'+e+'" border="0"/>'},generateHTMLForFlash:function(e,t){return'<embed src="'+e+"\" quality='high' "+this.getAllowScriptAccess(e)+" type='application/x-shockwave-flash' allowfullscreen='true' pluginspage='http://www.macromedia.com/go/getflashplayer' wmode='transparent' width='"+t.width+"' height='"+t.height+"'></embed>"},generateHTMLForMoviePlayer:function(e,t){return'<embed src="'+e+'" type="application/x-mplayer2" pluginspage="http://www.microsoft.com/Windows/MediaPlayer/" width=\''+t.width+"' height='"+t.height+"'></embed>"},generateHTMLForQuicktime:function(e,t){return'<embed src="'+e+'" type="video/quicktime" pluginspage="http://www.apple.com/quicktime/download/indext.html" width=\''+t.width+"' height='"+t.height+"'></embed>"},generateHTMLIfIframeSource:function(e,t){var r=o(e);if(r)return'<iframe src="http://videofarm.daum.net/controller/video/viewer/Video.html?play_loc=undefined&vid='+r+"\" width='"+t.width+"' height='"+t.height+'\' frameborder="0" allowfullscreen></iframe>';var i=c(e);return i?'<iframe src="http://www.youtube.com/embed/'+i+"\" width='"+t.width+"' height='"+t.height+'\' frameborder="0" allowfullscreen></iframe>':_NULL}}),Trex.register("filter > media ",function(e,a,n){var o=n.embeders.media.config;e.getDocParser().registerFilter("filter/embeder/media",{"text@load":function(e){return e},"source@load":function(e){return i(e)},"html@load":function(e){return i(e)},text4save:function(e){return e},source4save:function(e){return e=r(e),e=t(e,o)},html4save:function(e){return e=r(e),e=t(e,o)},text2source:function(e){return e},text2html:function(e){return e},source2text:function(e){return e},source2html:function(e){return i(e)},html2text:function(e){return r(e)},html2source:function(e){return r(e)}})})}();