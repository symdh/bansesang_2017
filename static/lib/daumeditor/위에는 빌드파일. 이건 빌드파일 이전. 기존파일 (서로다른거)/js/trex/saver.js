Trex.install("editor.getSaver & editor.getDataAsJSON & editor.setDataByJSON",function(t,e,n,r,o){var i=new Trex.Save(t,e,n,r,o);t.getSaver=function(){return i},t.getDataAsJSON=function(){var e=r.getContent(),o=new Trex.Validator;return o.exists(e)?{inputmode:r.getCurrentPanel().getName(),content:e,attachments:function(){var e=n.getAttachments();return t.getEntryProxy().getAttachments(e,_TRUE)}(),resultBox:function(){var e=t.getResultBox(),n=[];return e.datalist.each(function(t){n.push(t.data)}),n}(),formfield:t.getForm().getFormField()}:_NULL},t.setDataByJSON=function(e){if(e){var o=r.mode,i=e.inputmode||o;"original"==i||i!=o&&(r.fireJobs(Trex.Ev.__CANVAS_MODE_INITIALIZE,o,i),r.changeMode(i));var a=e.content;e.attachments&&t.getEntryProxy().setAttachments(e.attachments,a),a&&(a=t.getDocParser().convertAtLoad(a,o,i),r.initContent(a)),e.resultBox&&e.resultBox.each(function(t){var e;e=n.searchers[t._meta.type],e&&e.execReload(t,a)}),n.syncSidebar(),e.formfield&&t.getForm().setFormField(e.formfield)}}}),Trex.Save=Trex.Class.create({editor:_NULL,toolbar:_NULL,sidebar:_NULL,canvas:_NULL,config:_NULL,form:_NULL,initialize:function(t,e,n,r,o){this.editor=t,this.toolbar=e,this.sidebar=n,this.canvas=r,this.config=o,this.form=t.getForm(),this.docparser=t.getDocParser(),this.entryproxy=t.getEntryProxy()},save:function(){try{return("function"!=typeof validForm||validForm(this.editor))&&("function"!=typeof setForm||setForm(this.editor))?_TRUE:_FALSE}catch(t){return this.editor.fireJobs(Trex.Ev.__RUNTIME_EXCEPTION,t),_FALSE}},submit:function(){if(this.save())if(this.editor.fireJobs(Trex.Ev.__ON_SUBMIT,this.editor),this.config.save&&"function"==typeof this.config.save.onSave){var t=this.config.save.onSave;t()}else this.form.submit()},getContent:function(t){var e=this.canvas,n=e.mode,r=t||"original",o=e.getContent();return o=this.docparser.convertAtSave(o,n,r)},getAttachments:function(t,e){e=e||_FALSE;var n=this.sidebar.getAttachments(t);return this.entryproxy.getAttachments(n,e)},getEmbeddedData:function(t){return this.sidebar.getEmbeddedData(t)},getResults:function(t){return this.sidebar.getResults(t)},load:function(t){if(t={inputmode:t.inputmode&&"html"!=t.inputmode?t.inputmode:"original",content:function(){var e=t.content;return"string"==typeof e?t.content:e&&e.nodeType&&1==e.nodeType?t.content.value:""}(),attachments:t.attachments},this.editor.fireJobs(Trex.Ev.__EDITOR_LOAD_DATA_BEGIN,t),!t)throw new Error("[Exception]Trex.Save : not exist argument(data)");"function"==typeof loadForm&&loadForm(this.editor,t);try{this.setDataByJSONToEditor(t)}catch(e){alert(" - Error: "+e.message+"\n소스보기 모드로 전환합니다.\n잘못된 HTML이 있는지 확인해주세요."),t.inputmode=Trex.Canvas.__HTML_MODE;try{this.setDataByJSONToEditor(t)}catch(t){}}"function"==typeof postLoad&&postLoad(this.editor,t),this.editor.fireJobs(Trex.Ev.__EDITOR_LOAD_DATA_END)},setDataByJSONToEditor:function(t){this.editor.setDataByJSON(t)},makeField:function(){var t=this.sidebar,e=this.form,n=this.getContent();e.createField(tx.textarea({name:"tx_content",style:{display:"none"}},n));var r=t.getFields();r.each(function(t){e.createField(tx.input({type:"hidden",name:t.name,value:t.value}))})}});