Trex.Toolbar=Trex.Class.create({$mixins:[Trex.I.JobObservable],el:_NULL,tools:_NULL,initialize:function(e,t){this.canvas=e.getCanvas();var o=t.initializedId||"";this.el=$must("tx_toolbar_basic"+o,"Trex.Toolbar")},disableToolbar:function(){var e=this.tools;for(var t in e)e[t].button&&e[t].button.disable()},serializeToolValues:function(){var e=this.tools,t={};for(var o in e){var i=e[o];t[o]=i.button.lastValue}return t},widgetSeq:0,makeWidget:function(e,t,o){var i=this,n=this.canvas,r=new function(){this.identity="widget"+ ++i.widgetSeq,this.wysiwygonly=_TRUE,this.menuFoldAuto=_TRUE,this.canvas=n,this.toolbar=i};return Trex.Tool.prototype.weave.bind(r)(e,t,o),this.tools[r.identity]=r,r}}),Trex.install("editor.getTool",function(e,t){var o=t.tools={};e.getTool=function(e){return o[e]!=_NULL?o[e]:0==arguments.length?o:_NULL}}),Trex.register("new tools",function(e,t,o,i,n){var r=t.tools,a=n.initializedId||"";for(var s in Trex.Tool){var l=Trex.Tool[s].__Identity;if(l){var d=TrexConfig.getTool(l,n);d.initializedId=a,Trex.available(d,l+a)&&(r[l]=new Trex.Tool[s](e,t,d))}}i.config.readonly&&t.disableToolbar()}),Trex.module("bind events with tools",function(e,t,o,i){var n=t.tools,r=function(){var e,t,o,i;if(e=$tx.ios||$tx.android)for(t in n)o=n[t],o.disabledonmobile&&(i=o.button,i.disable())};r();var a=function(e,t){if(e!=t){for(var o in n){var i=n[o],a=i.button;Trex.Canvas.__WYSIWYG_MODE==t?a.enable():Trex.Canvas.__WYSIWYG_MODE==e&&(i.wysiwygonly?a.disable():a.enable())}r()}};i.observeJob(Trex.Ev.__CANVAS_MODE_CHANGE,a),i.observeJob(Trex.Ev.__CANVAS_MODE_INITIALIZE,a);var s=function(e){for(var t in n){var o=n[t];e!=o.identity&&(o.button&&(o.button.release(),o.button.decreaseZindex()),o.menu&&o.menuFoldAuto&&o.menu.release())}};i.observeJob(Trex.Ev.__CANVAS_PANEL_CLICK,s),i.observeJob(Trex.Ev.__CANVAS_SOURCE_PANEL_CLICK,s),i.observeJob(Trex.Ev.__CANVAS_TEXT_PANEL_CLICK,s),t.observeJob(Trex.Ev.__TOOL_CLICK,s),i.observeKey({ctrlKey:_FALSE,altKey:_FALSE,shiftKey:_FALSE,keyCode:27},s),e.observeKey({ctrlKey:_FALSE,altKey:_FALSE,shiftKey:_FALSE,keyCode:27},s),$tx.observe(_DOC,"click",function(e){var t=$tx.element(e),o=["tx-sidebar","tx-toolbar-basic","tx-toolbar-advanced","tx-sidebar-boundary","tx-toolbar-boundary","tx-toolbar-boundary"];Trex.Util.getMatchedClassName(t,o)&&s("-")},_FALSE);var l=function(){e.fireJobs(Trex.Ev.__SHOULD_CLOSE_MENUS)};t.observeJob(Trex.Ev.__TOOL_CLICK,l)}),Trex.Tool=Trex.Class.draft({identity:_NULL,button:_NULL,menu:_NULL,initialize:function(e,t,o){if(!this.constructor.__Identity)throw new Error("[Exception]Trex.Tool : not implement const(__Identity)");if(this.identity=this.constructor.__Identity,!e)throw new Error("[Exception]Trex.Tool : not exist argument(editor)");this.editor=e,this.toolbar=t,this.canvas=e.getCanvas(),this.config=o,this.wysiwygonly=o.wysiwygonly!=_NULL?o.wysiwygonly:_TRUE,this.menuFoldAuto=o.menuFoldAuto!=_NULL?o.menuFoldAuto:_TRUE,o.disabledonmobile!=_NULL&&(this.disabledonmobile=o.disabledonmobile),this.buttonCfg=TrexConfig.merge({id:"tx_"+this.identity},o),this.menuCfg=TrexConfig.merge({id:"tx_"+this.identity+"_menu"},o),this.oninitialized.bind(this)(o)},oninitialized:function(){throw new Error("[Exception]Trex.Tool : not implements function(oninitialized)")},weave:function(e,t,o,i){var n=this,r=this.identity,a=this.toolbar,s=this.canvas;this.button=e,e.tool=this;var l=_NULL;t?(this.menu=t,t.tool=this,t.initHandler=i||function(){},t.cancelHandler=function(){e.setState(_FALSE)},t.setCommand(l=function(){var t=arguments,i=o.apply(n,t);return i===$stop?e.normalState.apply(e,t):e.updateAfterCommand.apply(e,t),i}),e.setCommand(function(o){if(a.fireJobs(Trex.Ev.__TOOL_CLICK,r,o),e.isPushed()){if(t.hide(),$tx.msie){var i=s.getProcessor();i.restoreRange&&setTimeout(function(){i.restoreRange()},0)}}else{var n=e.getValue();e.increaseZindex(),t.show(n)}return _TRUE}),t.observeJob(Trex.Ev.__MENU_LAYER_SHOW,function(e){a.fireJobs(Trex.Ev.__MENU_LAYER_SHOW,e)}),t.observeJob(Trex.Ev.__MENU_LAYER_HIDE,function(e){a.fireJobs(Trex.Ev.__MENU_LAYER_HIDE,e)}),t.observeJob(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,function(e){a.fireJobs(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,e)})):e.setCommand(l=function(){return a.fireJobs(Trex.Ev.__TOOL_CLICK,r),o.apply(n,arguments)}),this.execute=l},resetWeave:function(){this.button.removeHandler(),this.button.normalState(),this.button=_NULL,this.menu=_NULL,this.execute=_NULL},forceActivate:function(){this.button&&this.menu&&(this.button.pushedState(),this.button.increaseZindex(),this.menu.show())},bindKeyboard:function(e,t){var o=this.toolbar,i=this.identity;this.canvas.observeKey(e,function(e){t(e),o.fireJobs(Trex.Ev.__TOOL_SHORTCUT_KEY,i)})}}),Trex.AsyncTool=Trex.Class.draft({$extend:Trex.Tool,oninitialized:function(){throw this.loaded=!1,new Error("[Exception]Trex.AsyncTool : not implements function(oninitialized)")},onLoadModule:function(){var e=this,t=this.config.asyncUrl;if(/^(?:\/\/)|(?:\w+:\/\/)/.test(t)===!1&&(t=this.getJSBasePath()+t),"development"==EditorJSLoader.getOption("environment")){var o=(new Date).getTime();t+=t.indexOf("?")===-1?"?dummy="+o:"&dummy="+o}Editor.editorForAsyncLoad=this.editor,EditorJSLoader.asyncLoadModule({url:TrexConfig.getUrl(t),callback:function(){e.loaded=!0}})},getJSBasePath:function(){var e;try{e=EditorJSLoader.getJSBasePath("editor.js")}catch(t){e=EditorJSLoader.getJSBasePath()}return e}}),Trex.I.Tool={},Trex.I.Tool.QueryStyle={},Trex.I.Tool.QueryStyle.Standard=Trex.Mixin.create({queryNodeStyle:function(e,t,o,i){return $tx.getStyle(e,t).include(o)}}),Trex.I.Tool.QueryStyle.Gecko=Trex.Mixin.create({queryNodeStyle:function(e,t,o,i){for(var n=e,r=_FALSE;n&&!$tom.isBody(n)&&!r;)r=$tom.isTagName(n,i)?_TRUE:$tx.getStyle(e,t).include(o),n=n.parentNode;return r}});