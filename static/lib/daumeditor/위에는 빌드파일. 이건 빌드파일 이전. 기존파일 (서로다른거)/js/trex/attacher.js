TrexMessage.addMsg({"@attacher.can.modify.alert":"기존에 등록된 #{title}을(를) 수정할 수 있는 화면으로 이동합니다.","@attacher.can.modify.confirm":"#{title}은(는) 하나만 등록이 가능합니다.\n다시 올리시면 기존의 #{title}이(가) 삭제됩니다. 계속하시겠습니까?","@attacher.insert.alert":"에디터 상태에서만 삽입할 수 있습니다.","@attacher.capacity.alert":"용량을 초과하였습니다.","@attacher.size.alert":"용량을 초과하여 더이상 등록할 수 없습니다."}),Trex.install("sidebar.getAttacher & sidebar.getUploadAdaptor",function(t,e,i){var a=i.attachers={};i.getAttacher=function(t){return a[t]!=_NULL?a[t]:0==arguments.length?a:_NULL}}),Trex.register("new attachers",function(t,e,i,a,r){var n=t.getAttachBox(),c=i.attachers;for(var s in Trex.Attacher){var h=Trex.Attacher[s].__Identity;h&&(c[h]=new Trex.Attacher[s](t,n,r))}c.file&&(i.getUploadAdaptor=function(){return c.file.getAdaptor()})}),Trex.Attacher=Trex.Class.draft({$extend:Trex.Actor,canModified:_FALSE,canResized:_FALSE,initialize:function(t,e,i){this.editor=t,this.canvas=t.getCanvas(),this.entryBox=e;var a=this.config=TrexConfig.getAttacher(this.constructor.__Identity,i);i.pvpage&&a.usepvpage&&(this.pvUrl=TrexConfig.getUrl(i.pvpage,{pvname:this.name})),this.boxonly=a.boxonly!=_NULL?a.boxonly:_FALSE,this.isMultiple=a.multiple!=_NULL?a.multiple:_FALSE,this.isCheckSize=a.checksize!=_NULL?a.checksize:_FALSE,this.wysiwygonly=a.wysiwygonly!=_NULL?a.wysiwygonly:_TRUE,this.pastescope=a.pastescope,this.oninitialized&&this.oninitialized(i),this.attachHandler=this.attachHandler.bind(this)},execute:function(t){if(this.wysiwygonly&&!this.canvas.isWYSIWYG())return void alert(TXMSG("@attacher.insert.alert"));if(this.isCheckSize&&!this.entryBox.checkAvailableCapacity())return void alert(TXMSG("@attacher.capacity.alert"));if(!this.checkInsertable())if(this.canModified){var e=new Template(TXMSG("@attacher.can.modify.alert"));alert(e.evaluate({title:this.title}))}else{var e=new Template(TXMSG("@attacher.can.modify.confirm"));if(!confirm(e.evaluate({title:this.title})))return}if(this.clickHandler)this.clickHandler();else try{var i=this.config.popPageUrl;t&&(i=i+(i.indexOf("?")>-1?"&":"?")+t);var a=document.location.hostname!=document.domain;a&&(i=i+(i.indexOf("?")>-1?"&":"?")+"xssDomain="+document.domain),i=this.pvUrl?this.pvUrl+(this.pvUrl.indexOf("?")>-1?"&":"?")+"u="+escape(i):i;var r=_WIN.open(i,"at"+this.name,this.config.features);r.focus()}catch(t){}},attachHandler:function(t,e){if(this.checkInsertable()){if(this.isCheckSize&&!this.entryBox.checkInsertableSize(t.filesize))return void alert(TXMSG("@attacher.size.alert"));this.execAttach(t,e)}else this.execReattach(t,e)},createEntry:function(t,e){return this.createAttachment(t,e)},createAttachment:function(t,e){var i=this.constructor.__Identity;return e&&(i=e),new(Trex.Attachment[i.capitalize()])(this,t)},checkInsertable:function(){if(this.isMultiple)return _TRUE;var t=this.getDatalist().findAll(function(t){return t.deletedMark!=_TRUE});return 0===t.length}});