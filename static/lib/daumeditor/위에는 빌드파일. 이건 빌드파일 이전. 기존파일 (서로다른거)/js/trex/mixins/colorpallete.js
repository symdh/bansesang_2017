TrexMessage.addMsg({"@menu.pallete.revert":"기본색으로","@adoptor.label":"가나다","@adoptor.transparent":"투명"}),Trex.MarkupTemplate.add("menu.colorpallete.text",'#{for:items}<li class="tx-menu-list-item" style="background-color:#{color}"><a unselectable="on" style="color:#{text}">#{label}</a></li>#{/for:items}'),Trex.MarkupTemplate.add("menu.colorpallete.thumb",'#{for:items}<li class="tx-menu-list-item" unselectable="on" style="background-color:#{color};border:none;#{if:image!=null}background-image:url(#{image})#{/if:image};"></li>#{/for:items}'),Trex.MarkupTemplate.add("menu.colorpallete.revert",'<p class="tx-pallete-revert"><a unselectable="on" href="javascript:;" title="@menu.pallete.revert">@menu.pallete.revert</a></p>'),Trex.I.ColorPallete=Trex.Faculty.create({isGradeInit:_FALSE,isPickerDisplayed:_FALSE,onregenerated:function(t,e){this.setColorValueAtInputbox(e)},setColorValueAtInputbox:function(t){if(t){"string"!=typeof t&&t.toString&&(t=t.toString());var e=t.split("|")[0];Trex.Color.getValidColor(e)||(e="#000000");var o=$tom.collect(this.elInner,"p.tx-pallete-input input"),r=$tom.collect(this.elInner,"p.tx-pallete-input span");t&&o&&r&&(o.value=e,r.style.backgroundColor=e)}},hookEvent:function(t){var e=this.elMenu,o=this.elInner=$tom.collect(e,"div.tx-menu-inner"),r=$tom.collect(o,"ul.tx-pallete-text-list");if(t.texts){var i=t.texts.options;Trex.MarkupTemplate.get("menu.colorpallete.text").evaluateToDom({items:i},r);var s=$tom.collectAll(r,"li");this.addColorClickEvent(s,i)}else o.removeChild(r),r=_NULL;if(t.thumbs){var n=!!t.needTrans,l=[].concat(t.thumbs.options);n&&(l.pop(),l.push(Object.extend({},t.thumbs.transparent)));var a=$tom.collect(o,"ul.tx-pallete-thumb-list");Trex.MarkupTemplate.get("menu.colorpallete.thumb").evaluateToDom({items:l},a);var h=$tom.collectAll(a,"li");this.addColorClickEvent(h,l)}this.elPicker=$tom.collect(o,"div.tx-pallete-picker");var u=$tom.collect(o,"div.tx-pallete-buttons"),c=this.elMore=$tom.collect(u,"p.tx-pallete-more a");$tx.observe(c,"click",this.togglePicker.bind(this)),t.needRevert&&($tom.insertFirst(u,Trex.MarkupTemplate.get("menu.colorpallete.revert").evaluateAsDom({})),$tx.observe($tom.collect(u,"p.tx-pallete-revert a"),"click",function(t){this.onSelect(t,_NULL),this.hide()}.bind(this)));var m=$tom.collect(this.elInner,"p.tx-pallete-input");this.elPreview=$tom.collect(m,"span");var v=this.elInput=$tom.collect(m,"input"),p=this.elEnter=$tom.collect(m,"a"),d=this;$tx.observe(v,"blur",function(){d.lastValue=v.value}),$tx.observe(p,"click",this.onColorEnter.bind(this))},addColorClickEvent:function(t,e){for(var o=0,r=t.length;o<r;o++){var i=t[o],s=e[o];$tx.observe(i,"click",this.onSelect.bindAsEventListener(this,s.color+(s.text?"|"+s.text:"")))}},_generatePicker:function(){var t=this.elPicker,e=$tom.collect(t,"div.tx-pallete-pickerbox");$tx.observe(e,"mouseout",this.onMouseOut.bind(this));var o=this.elChromaBar=$tom.collect(e,"div.tx-chromabar");$tom.replacePngPath(o),$tx.observe(o,"mousedown",this.onChromDown.bindAsEventListener(this)),$tx.observe(o,"mousemove",this.onChromMove.bindAsEventListener(this)),$tx.observe(o,"mouseup",this.onChromUp.bindAsEventListener(this)),this.elHueBar=$tom.collect(e,"div.tx-huebar");var r=this.elHueBar;this.hueDownHandler=this.onHueDown.bindAsEventListener(this),this.hueMoveHandler=this.onHueMove.bindAsEventListener(this),this.hueUpHandler=this.onHueUp.bindAsEventListener(this),this.hueClickHandler=this.onHueClick.bindAsEventListener(this),$tx.observe(r,"mousedown",this.hueDownHandler),$tx.observe(r,"click",this.hueClickHandler),this.nColWidth=150,this.nColHeight=120,this.nHueHeight=120,this.mRGB={r:0,g:0,b:0},this.mHSV={h:0,s:100,v:100},this.setHueColor("FF0000")},reinitGrade:function(){var t=$tx.cumulativeOffset(this.elMenu),e=$tx.positionedOffset(this.elChromaBar);this.iChromPos={x:t[0]+e[0],y:t[1]+e[1]},e=$tx.positionedOffset(this.elHueBar),this.iHuePos={x:t[0]+e[0],y:t[1]+e[1]}},onColorEnter:function(t){var e;e=this.elInput.value==TXMSG("@adoptor.transparent")?"transparent":Trex.Color.getValidColor(this.elInput.value),e!==_NULL&&this.onSelect(t,e),this.hide()},previewColor:function(t){this.changeColor(t)},onMouseOut:function(){this.lastValue!==_NULL&&this.lastValue!==_UNDEFINED&&this.mousedownDetected&&this.changeColor(this.lastValue)},changeColor:function(t){t=Trex.Color.getHexColor(t),this.elPreview.style.backgroundColor=t,"transparent"==t?this.elInput.value=TXMSG("@adoptor.transparent"):this.elInput.value=t},enterColor:function(){if(this.elInput.value==TXMSG("@adoptor.transparent"))this.changeColor("transparent");else if(7==this.elInput.value.length){var t=Trex.Color.getValidColor(this.elInput.value);t!==_NULL&&this.changeColor(t)}},togglePicker:function(t){var e=this.elMore,o=this.elPicker;this.isPickerDisplayed?(e.className="tx-more-down",$tx.hide(o)):(e.className="tx-more-up",$tx.show(o),$tx.msie6&&(o.style.padding="1px",setTimeout(function(){o.style.padding="0px"},0)),this.isGradeInit||(this._generatePicker(),this.isGradeInit=_TRUE,this.reinitGrade())),this.isPickerDisplayed=!this.isPickerDisplayed,$tx.stop(t)},getChromCoords:function(t){var e=t.clientX-this.iChromPos.x+_DOC_EL.scrollLeft,o=t.clientY-this.iChromPos.y+_DOC_EL.scrollTop;return e=Math.min(this.nColWidth,Math.max(0,e)),o=Math.min(this.nColHeight,Math.max(0,o)),{x:e,y:o}},getHueCoords:function(t){var e=t.offsetY||t.layerY;return Math.min(this.nHueHeight,Math.max(0,e))},getColorByEvent:function(t,e){var o=t/this.nColWidth*100,r=100*(1-e/this.nColHeight),i=3;return o=Math.floor(Math.min(Math.max(o,0),100)),o<i?o=0:o>100-i&&(o=100),r=Math.floor(Math.min(Math.max(r,0),100)),r<i?r=0:r>100-i&&(r=100),this.mHSV.s=o,this.mHSV.v=r,this.mRGB=this.hsv2rgb(this.mHSV.h,this.mHSV.s,this.mHSV.v),this.rgb2hex(this.mRGB.r,this.mRGB.g,this.mRGB.b)},onChromDown:function(){this.mousedownDetected=_TRUE},onChromMove:function(t){if(this.mousedownDetected){var e=this.getChromCoords(t),o=this.getColorByEvent(e.x,e.y);this.previewColor(o)}},onChromUp:function(t){var e=this.getChromCoords(t),o=this.getColorByEvent(e.x,e.y);this.previewColor(o),this.lastValue=o,this.mousedownDetected=_FALSE},getHueByEvent:function(t){var e=parseInt(t/this.nHueHeight*360);this.mHSV.h=Math.floor(Math.min(Math.max(e,0),360));var o=this.hsv2rgb(this.mHSV.h,100,100);return this.rgb2hex(o.r,o.g,o.b)},setHueColor:function(t){this.elChromaBar.style.backgroundColor=t},onHueDown:function(){$tx.observe(_DOC,"mousemove",this.hueMoveHandler),$tx.observe(_DOC,"mouseup",this.hueUpHandler)},onHueMove:function(t){var e=this.getHueCoords(t),o=this.getHueByEvent(e);this.setHueColor(o)},onHueClick:function(t){var e=this.getHueCoords(t),o=this.getHueByEvent(e);this.setHueColor(o)},onHueUp:function(){$tx.stopObserving(_DOC,"mousemove",this.hueMoveHandler),$tx.stopObserving(_DOC,"mouseup",this.hueUpHandler)},hex2rgb:function(t){return this.mRGB.r=16*this.toDec(t.substr(0,1))+this.toDec(t.substr(1,1)),this.mRGB.g=16*this.toDec(t.substr(2,1))+this.toDec(t.substr(3,1)),this.mRGB.b=16*this.toDec(t.substr(4,1))+this.toDec(t.substr(5,1)),this.mRGB},toDec:function(t){var e="0123456789ABCDEF";return e.indexOf(t.toUpperCase())},rgb2hex:function(t,e,o){return t=t.toString(16),1==t.length&&(t="0"+t),e=e.toString(16),1==e.length&&(e="0"+e),o=o.toString(16),1==o.length&&(o="0"+o),"#"+t+e+o},hsv2rgb:function(t,e,o){t%=360,e/=100,o/=100;var r=0,i=0,s=0;if(0===e)r=Math.floor(255*o),i=Math.floor(255*o),s=Math.floor(255*o);else{var n=t/60,l=Math.floor(n),a=o*(1-e),h=o*(1-e*(n-l)),u=o*(1-e*(1-(n-l))),c=0,m=0,v=0;0===l?(c=o,m=u,v=a):1==l?(c=h,m=o,v=a):2==l?(c=a,m=o,v=u):3==l?(c=a,m=h,v=o):4==l?(c=u,m=a,v=o):5==l&&(c=o,m=a,v=h),r=Math.floor(255*c),i=Math.floor(255*m),s=Math.floor(255*v)}return{r:r,g:i,b:s}},rgb2hsv:function(t,e,o){var r=t/255,i=e/255,s=o/255,n=0,l=0,a=0,h=Math.min(r,i,s),u=Math.max(r,i,s),c=u-h;if(a=c,0===c)n=0,l=0;else{l=c/u;var m=((u-r)/6+c/2)/c,v=((u-i)/6+c/2)/c,p=((u-s)/6+c/2)/c;r==u?n=p-v:i==u?n=1/3+m-p:s==u&&(n=2/3+v-m),n<0&&(n+=1),n>1&&(n-=1)}return{h:n,s:l,v:a}}}),Trex.Color={getHexColor:function(t){if(t=t.trim(),t.indexOf("rgb")<0)return t.length>0&&(t.indexOf("-moz-use")>-1||"transparent"==t)?"transparent":t;if(/rgba\s?\((0,\s?){3}0\)/i.test(t))return"transparent";var e=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+),?\s*\d*\)/i);if(!e)return t;if(e.shift(),e.length<3)return t;for(var o,r="#",i=0;i<3;i++)o=parseInt(e[i].trim()).toString(16).toUpperCase(),r=1==o.length?r.concat("0"+o):o.length>2?r.concat("FF"):r.concat(""+o);return r},getValidColor:function(t){if(t===_NULL||"transparent"==t)return"transparent";var e=t.match(/#?([0-9a-f]{6}|[0-9a-f]{3})/i);return e===_NULL||t.length>8?_NULL:3==e[1].length?"#"+e[1]+e[1]:"#"+e[1]},getOptColor:function(t,e){if(!t||7!=t.length||"#"!=t.charAt(0))return"#e5e5e5";t=t.substring(1,7).toLowerCase(),e=isNaN(e)?100:e;for(var o,r,i="#",s=0;s<3;s++)o=parseInt(t.substr(2*s,2),16),r=Math.round(Math.floor((255-o)*(1-.01*e)+o*(.02*e))).toString(16),i+=1==r.length?"0"+r:r.length>2?"ff":r;return i}};