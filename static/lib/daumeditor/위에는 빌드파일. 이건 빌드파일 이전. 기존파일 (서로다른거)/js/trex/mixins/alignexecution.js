Trex.I.AlignExecution=Trex.Mixin.create({executeAlignImageMode:function(e){var t=this.constructor.__ImageModeProps.image,r=e.getControl();if(r){e.apply(r,t);var a=this.constructor.__ImageModeProps.paragraph;if(a){var n=$tom.find(r,"%paragraph");e.apply(n,a)}}},executeAlignTextMode:function(e){var t=this.constructor.__TextModeProps.paragraph,r=e.getControl();if(r&&$tom.kindOf(r,"button")){var a=$tom.find(r,"%paragraph");a&&e.apply(a,t);var n=$tom.collect(r,"blockquote");n&&(n.style.margin=this.constructor.__TextModeProps.button.style.margin)}else{var o=e.blocks(function(){return"%paragraph"});e.apply(o,t);var i=[];o.each(function(e){var t;t=$tom.collectAll(e,"table,hr"),t.each(function(e){i.push(e)})}),e.apply(i,{align:t.style.textAlign})}},queryImageFloat:function(e){var t=e.getControl();return t?e.queryStyle(t,"float"):_NULL},queryParaFloat:function(e){var t,r=e.findNode("%paragraph");return r&&(t=e.queryStyle(r,"float")),t||_NULL},queryTextAlign:function(e){var t=e.findNode("%paragraph"),r=e.queryStyle(t,"textAlign");return r||(r=e.queryAttr(t,"align")),r&&"start"!=r&&"auto"!=r&&"-webkit-auto"!=r||(r="left"),r},queryControlAlign:function(e){var t=e.getControl();return e.queryAttr(t,"align")},executeAlign:function(e){var t=this,r=t.getAlignMode(e);"tableCell"==r?t.executeTableCellMode(e):"image"==r?t.executeAlignImageMode(e):t.executeAlignTextMode(e)},getAlignMode:function(e){var t=e.table?e.table.getTdArr():[];return t.length>0?"tableCell":this.imageAlignMode?"image":"text"},executeTableCellMode:function(e){function t(e){$tom.applyAttributes(e,n.constructor.__TextModeProps.paragraph)}if(!this.indenter){var r=Trex.Tool.Indent.Judge,a=Trex.ChainHandler,n=this,o=a.connect([new a(r.ListItem,t),new a(r.BlockNode,t)]);this.indenter=new Trex.Tool.Indent.TableCellIndenter(o)}this.indenter.indent(e)},syncButtonState:function(){var e=this,t=e.canvas.query(function(t){return e.queryCurrentStyle(t)});e.button.setState(t)},queryCurrentStyle:function(e){return this.imageAlignMode?this.queryImageMode(e):this.queryTextMode(e)},queryImageMode:function(e){var t=this.constructor.__ImageModeProps,r=this.queryImageFloat(e);if(r&&"none"!=r&&t.image&&t.image.style.float)return r==t.image.style.float;var a=this.queryParaFloat(e);if(a&&"none"!=a&&t.paragraph&&t.paragraph.style.float)return a==t.paragraph.style.float;var n=this.queryTextAlign(e);return t.paragraph&&t.paragraph.style.textAlign?n==t.paragraph.style.textAlign:_FALSE},queryTextMode:function(e){var t=this.constructor.__TextModeProps,r=t.paragraph.style.textAlign,a=this.queryControlAlign(e);if(a==_NULL){var n=this.queryTextAlign(e)||"left";return n==r}return a==r}});